
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Cameron Presley">
      
      
      
        <link rel="prev" href="../debugging/">
      
      
        <link rel="next" href="../interviewing/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16+insiders-4.53.16">
    
    
      
        <title>Functional Programming - The Software Mentor</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.1caf78d2.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/page.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-ZE0MGVG7RJ"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-ZE0MGVG7RJ",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-ZE0MGVG7RJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functional-programming" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="The Software Mentor" class="md-header__button md-logo" aria-label="The Software Mentor" data-md-component="logo">
      
  <img src="../../../assets/images/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Software Mentor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Functional Programming
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  About Me

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  Articles

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../courses/" class="md-tabs__link">
        
  
  
    
  
  Training Course

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../level-up/" class="md-tabs__link">
        
  
  
    
  
  Level Up Resources

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../presentations/" class="md-tabs__link">
        
  
  
    
  
  Presentations

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../speaking-schedule/" class="md-tabs__link">
        
  
  
    
  
  Speaking Schedule

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../story/" class="md-tabs__link">
        
  
  
    
  
  Story

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../resume/" class="md-tabs__link">
        
  
  
    
  
  Resume

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="The Software Mentor" class="md-nav__button md-logo" aria-label="The Software Mentor" data-md-component="logo">
      
  <img src="../../../assets/images/favicon.png" alt="logo">

    </a>
    The Software Mentor
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About Me
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Articles
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Articles
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2025
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2018/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2018
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2015/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2015
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2014/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2014
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2013/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2013
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../net/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    .NET
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C#
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../career/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Career
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../coaching-corner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coaching Corner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Functional Programming
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../interviewing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interviewing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../leadership/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Leadership
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../learning-through-example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Learning Through Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../solid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOLID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../today-i-learned/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Today I Learned
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../tooling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tooling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../typescript/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TypeScript
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../courses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training Course
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../level-up/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level Up Resources
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../presentations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Presentations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../speaking-schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Speaking Schedule
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../story/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Story
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resume/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resume
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="functional-programming">Functional Programming</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-12-01 00:00:00+00:00">Dec 1, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../net/" class="md-meta__link">.NET</a>, 
              <a href="./" class="md-meta__link">Functional Programming</a></li>
        
        
          
          <li class="md-meta__item">
            
              8 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="reducing-bugs-by-using-the-model-view-update-pattern"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/">Reducing Bugs by Using the Model View Update Pattern</a></h2>
<p><em>Note: This article is part of the <a href="https://csadvent.christmas/">2025 C# Advent Calendar</a>, so after you're done reading this, keep an eye out for the other cool articles coming out this month!</em></p>
<p>For those who've followed me for a bit, you know that I'm a big believer that functional programming is a great way of approaching problems.</p>
<p>One thing I've mentioned in my <a href="../../../presentations/#learning-functional-programming-through-construction-first-principles">recent presentations</a> is that we can take introductory concepts (pure functions, immutability, composition) and build <em>real world software</em> with them.</p>
<p>In this post, I'm going to show you a pattern that I've recently ported to C#, the <a href="https://guide.elm-lang.org/architecture/">Model View Update, also known as The Elm Architecture</a>.</p>
<h3 id="inspiration-of-the-pattern"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#inspiration-of-the-pattern">Inspiration of the Pattern</a></h3>
<p>Back in 2017, I came across a new functional language called <a href="https://elm-lang.org/">Elm</a> that took a different approach for web development. At a high level, Elm argues that you can think of an application as four pieces.</p>
<ol>
<li>The <em>Model</em> - What data are we presenting to the user?</li>
<li>The <em>View</em> - How should we format the model?</li>
</ol>
<p>At this point, this seems very similar to other MV* patterns (<a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model View Controller</a>, <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter">Model View Presenter</a>, or <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel">Model View ViewModel</a>). </p>
<p>The next two parts is what sets this pattern apart from the others.</p>
<ol>
<li>The <em>Command</em> - What things can the user do on the screen (button clicks, entering text, etc...)</li>
<li>The <em>Update</em> function - Given a <em>Model</em> and a <em>Command</em>, what does the new model look like?</li>
</ol>
<p>To me, this is an interesting concept because when the user makes changes, the model is being directly manipulated (generally through two-way binding) and then you had to make sure that you didn't put your business rules directly in the UI code. (For those who come from WinForms, how many times did you find business code in the code-behind?).</p>
<p>With this approach, however, we've narrowed down what the UI can do (it can render a model and return a command, but can't directly manipulate the model). </p>
<p>If you think that this approach isn't solid, you might be surprised to know that Elm inspired the creation of the following libraries in the JavaScript ecosystem:</p>
<ul>
<li><a href="https://ngrx.io/">ngrx</a> (Angular state management system)</li>
<li><a href="https://redux.js.org/">redux</a> (React state management system)</li>
</ul>
<p>I've recently been using this pattern for console applications and have been pleasantly surprised how well it's working out.</p>
<p>In this post, I'll walk you through how we can use this pattern to build out the "Hello World" equivalent application, manipulating a counter.</p>
<h3 id="implementing-the-pattern"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#implementing-the-pattern">Implementing the Pattern</a></h3>
<h4 id="defining-the-command"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#defining-the-command">Defining the Command</a></h4>
<p>Before we can model the <code>Command</code>, we need to think about what commands we want to support. In our example, let's say that we want the user to be able to do the following:</p>
<ul>
<li>Increment the counter by 2</li>
<li>Decrement the counter by 1</li>
<li>Reset the counter to 0</li>
<li>Quit the application</li>
</ul>
<p>In the Elm version (and it's equivalent TypeScript definition), a <code>Command</code> looks something like this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;increment&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="kt">2</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;decrement&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="kt">1</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;reset&#39;</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="nx">tag</span><span class="o">:</span><span class="s1">&#39;quit&#39;</span><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>This takes advantage of algebraic data type  known as a <a href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/">sum type</a>, where the <code>Command</code> type has one of three different constructors (one called <code>increment</code>, another called <code>decrement</code>, one called <code>reset</code>, and finally, <code>quit</code>). </p>
<p>Even though C# doesn't have sum types (at least <a href="https://github.com/dotnet/csharplang/issues/9662">not yet</a>), we can mimic this behavior using an abstract class.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span>
<span class="normal"><a href="#__codelineno-34-5">5</a></span>
<span class="normal"><a href="#__codelineno-34-6">6</a></span>
<span class="normal"><a href="#__codelineno-34-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1">// Abstract command that uses a string to</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="c1">// denote which command it is</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="c1">// (useful for casting later)</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Command</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="p">:</span><span class="n">Enum</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="p">{</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="defining-commands-for-counter"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#defining-commands-for-counter">Defining Commands for Counter</a></h4>
<p>With the <code>Command</code> class defined, let's start implementing the various commands our program can have.</p>
<p>First, we'll define an <code>enum</code> to keep track of the types of <code>Commands</code>. We could omit this and just use strings, but the value of the <code>enum</code> is that we can have C# generate the cases (though we still have to have a default case given the nature of enums).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1">// Enum to help with exhaustive matching later</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="c1">// on</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">CommandType</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="p">{</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="w">  </span><span class="n">Increment</span><span class="p">,</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">  </span><span class="n">Decrement</span><span class="p">,</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">  </span><span class="n">Reset</span><span class="p">,</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">  </span><span class="n">Quit</span><span class="p">,</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">  </span><span class="n">Unknown</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With the enum defined, we can start define the commands, some of which will have more information included (see the <em>IncrementCommand</em> and <em>DecrementCommand</em>).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span>
<span class="normal"><a href="#__codelineno-36-25">25</a></span>
<span class="normal"><a href="#__codelineno-36-26">26</a></span>
<span class="normal"><a href="#__codelineno-36-27">27</a></span>
<span class="normal"><a href="#__codelineno-36-28">28</a></span>
<span class="normal"><a href="#__codelineno-36-29">29</a></span>
<span class="normal"><a href="#__codelineno-36-30">30</a></span>
<span class="normal"><a href="#__codelineno-36-31">31</a></span>
<span class="normal"><a href="#__codelineno-36-32">32</a></span>
<span class="normal"><a href="#__codelineno-36-33">33</a></span>
<span class="normal"><a href="#__codelineno-36-34">34</a></span>
<span class="normal"><a href="#__codelineno-36-35">35</a></span>
<span class="normal"><a href="#__codelineno-36-36">36</a></span>
<span class="normal"><a href="#__codelineno-36-37">37</a></span>
<span class="normal"><a href="#__codelineno-36-38">38</a></span>
<span class="normal"><a href="#__codelineno-36-39">39</a></span>
<span class="normal"><a href="#__codelineno-36-40">40</a></span>
<span class="normal"><a href="#__codelineno-36-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">IncrementCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="p">{</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Increment</span><span class="p">;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">  </span><span class="c1">// Since some of the commands will have custom values and others not, </span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">  </span><span class="c1">// we can inject those values through the constructor</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">init</span><span class="p">;}</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="nf">IncrementCommand</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="p">}</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DecrementCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="p">{</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Decrement</span><span class="p">;</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">init</span><span class="p">;}</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="nf">DecrementCommand</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a><span class="p">}</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a><span class="c1">// In other cases, we don&#39;t need</span>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a><span class="c1">// any other info, so we can inherit and implement the Tag property</span>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ResetCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a><span class="p">{</span>
<a id="__codelineno-36-30" name="__codelineno-36-30"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Reset</span><span class="p">;</span>
<a id="__codelineno-36-31" name="__codelineno-36-31"></a><span class="p">}</span>
<a id="__codelineno-36-32" name="__codelineno-36-32"></a>
<a id="__codelineno-36-33" name="__codelineno-36-33"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">QuitCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-36-34" name="__codelineno-36-34"></a><span class="p">{</span>
<a id="__codelineno-36-35" name="__codelineno-36-35"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Quit</span><span class="p">;</span>
<a id="__codelineno-36-36" name="__codelineno-36-36"></a><span class="p">}</span>
<a id="__codelineno-36-37" name="__codelineno-36-37"></a>
<a id="__codelineno-36-38" name="__codelineno-36-38"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UnknownCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-36-39" name="__codelineno-36-39"></a><span class="p">{</span>
<a id="__codelineno-36-40" name="__codelineno-36-40"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Unknown</span><span class="p">;</span>
<a id="__codelineno-36-41" name="__codelineno-36-41"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="implementing-the-update-function"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#implementing-the-update-function">Implementing the Update Function</a></h4>
<p>Now that we have our various commands created, we can start building out the <code>Update</code> function. </p>
<p>From our earlier description, we know that our <code>Update</code> function has to take in our model (a number) and a <code>Command</code> and then has to return a new model (a number).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1">// This example is a static method, but let&#39;s say that the rules were more complicated, </span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="c1">// we could inject those into a class and make this method non-static.</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="p">{</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">  </span><span class="c1">// I&#39;m leveraging the new switch syntax, </span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">  </span><span class="c1">// but you can use the original syntax</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">  </span><span class="c1">// without issues</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">    </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Increment</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">IncrementCommand</span><span class="p">)</span><span class="n">c</span><span class="p">).</span><span class="n">Value</span><span class="p">,</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">    </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Decrement</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="n">DecrementCommand</span><span class="p">)</span><span class="n">c</span><span class="p">).</span><span class="n">Value</span><span class="p">,</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">    </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Reset</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">    </span><span class="c1">// In the case we&#39;re told to quit or we</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">    </span><span class="c1">// get an unknown command, we&#39;ll return</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">    </span><span class="c1">// the model back</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">    </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Quit</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">number</span><span class="p">,</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="w">    </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Unknown</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">number</span><span class="p">,</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w">    </span><span class="c1">// Since C# doesn&#39;t have exhaustive matching, we still require the default case here</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">number</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="implementing-the-view-function"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#implementing-the-view-function">Implementing the View Function</a></h4>
<p>At this point, we could go ahead and start writing tests to verify that our model is being updated given the command, but our users are going to be interacting with the application, so let's build that out next.</p>
<p>From before, we know that the <code>View</code> function takes in the model (a number) and it will return a <code>Command</code>. Given that we need to interact with the user, this is an <a href="https://en.wikipedia.org/wiki/Pure_function#Impure_functions">impure function</a> by design, so we shouldn't put our business rules in here.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">View</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="w">  </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;Counter: {model}&quot;</span><span class="p">);</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="w">  </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;(I)ncrement, (D)ecrement, (R)eset, or (Q)uit&quot;</span><span class="p">);</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nf">ConvertStringToCommand</span><span class="p">(</span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">());</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="p">}</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="c1">// Even though this is called by the View</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="c1">// function, this is a Pure function</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="c1">// because it only depends upon a string</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="c1">// for its logic</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ConvertStringToCommand</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Trim</span><span class="p">().</span><span class="n">ToLower</span><span class="p">()</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="w">    </span><span class="s">&quot;i&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IncrementCommand</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="c1">// will increment by 2</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="w">    </span><span class="s">&quot;d&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DecrementCommand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="c1">// will decrement by 1</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="w">    </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResetCommand</span><span class="p">(),</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="w">    </span><span class="s">&quot;q&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QuitCommand</span><span class="p">(),</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnknownCommand</span><span class="p">()</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="wiring-everything-together"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#wiring-everything-together">Wiring Everything Together</a></h4>
<p>Now that we have our Model (a number), the <code>View</code> function, an <code>Update</code> function, and our list of <code>Command</code>s, we can wire everything together.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span>
<span class="normal"><a href="#__codelineno-39-20">20</a></span>
<span class="normal"><a href="#__codelineno-39-21">21</a></span>
<span class="normal"><a href="#__codelineno-39-22">22</a></span>
<span class="normal"><a href="#__codelineno-39-23">23</a></span>
<span class="normal"><a href="#__codelineno-39-24">24</a></span>
<span class="normal"><a href="#__codelineno-39-25">25</a></span>
<span class="normal"><a href="#__codelineno-39-26">26</a></span>
<span class="normal"><a href="#__codelineno-39-27">27</a></span>
<span class="normal"><a href="#__codelineno-39-28">28</a></span>
<span class="normal"><a href="#__codelineno-39-29">29</a></span>
<span class="normal"><a href="#__codelineno-39-30">30</a></span>
<span class="normal"><a href="#__codelineno-39-31">31</a></span>
<span class="normal"><a href="#__codelineno-39-32">32</a></span>
<span class="normal"><a href="#__codelineno-39-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Framework</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="p">{</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Run</span><span class="o">&lt;</span><span class="n">TModel</span><span class="p">,</span><span class="w"> </span><span class="n">TCommandType</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">      </span><span class="n">Func</span><span class="o">&lt;</span><span class="n">TModel</span><span class="p">,</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">TCommandType</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">view</span><span class="p">,</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">      </span><span class="n">Func</span><span class="o">&lt;</span><span class="n">TModel</span><span class="p">,</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">TCommandType</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">TModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">update</span><span class="p">,</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="w">      </span><span class="n">TModel</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">TCommandType</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Enum</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">    </span><span class="c1">// We need the Enum to have a Quit option</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="w">    </span><span class="c1">// defined, otherwise, we won&#39;t know when</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="w">    </span><span class="c1">// to quit the application.</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Enum</span><span class="p">.</span><span class="n">IsDefined</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TCommandType</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Quit&quot;</span><span class="p">))</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">&quot;Command must have a Quit option&quot;</span><span class="p">);</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">quitCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enum</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TCommandType</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Quit&quot;</span><span class="p">);</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a><span class="w">    </span><span class="c1">// Getting our initial state</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">currentModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a><span class="w">    </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">TCommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">command</span><span class="p">;</span>
<a id="__codelineno-39-21" name="__codelineno-39-21"></a>
<a id="__codelineno-39-22" name="__codelineno-39-22"></a><span class="w">    </span><span class="c1">// While command isn&#39;t Quit</span>
<a id="__codelineno-39-23" name="__codelineno-39-23"></a><span class="w">    </span><span class="k">do</span>
<a id="__codelineno-39-24" name="__codelineno-39-24"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-39-25" name="__codelineno-39-25"></a><span class="w">      </span><span class="c1">// Clear the screen</span>
<a id="__codelineno-39-26" name="__codelineno-39-26"></a><span class="w">      </span><span class="n">Console</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<a id="__codelineno-39-27" name="__codelineno-39-27"></a><span class="w">      </span><span class="c1">// Get the command from when we render the view</span>
<a id="__codelineno-39-28" name="__codelineno-39-28"></a><span class="w">      </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="p">(</span><span class="n">currentModel</span><span class="p">);</span>
<a id="__codelineno-39-29" name="__codelineno-39-29"></a><span class="w">      </span><span class="c1">// Get the new model from update</span>
<a id="__codelineno-39-30" name="__codelineno-39-30"></a><span class="w">      </span><span class="n">currentModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">currentModel</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">);</span>
<a id="__codelineno-39-31" name="__codelineno-39-31"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">command</span><span class="p">.</span><span class="n">Tag</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">quitCommand</span><span class="p">));</span>
<a id="__codelineno-39-32" name="__codelineno-39-32"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-39-33" name="__codelineno-39-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="final-version"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#final-version">Final Version</a></h3>
<p>With the <code>Framework.Run</code> function defined, we can invoke it via our <code>Program.cs</code> file.</p>
<p>You can find the working version below (or you can <a href="https://github.com/cameronpresley/csharp-elm-example">clone a copy from GitHub</a>)</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Program.cs</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span>
<span class="normal"><a href="#__codelineno-40-19">19</a></span>
<span class="normal"><a href="#__codelineno-40-20">20</a></span>
<span class="normal"><a href="#__codelineno-40-21">21</a></span>
<span class="normal"><a href="#__codelineno-40-22">22</a></span>
<span class="normal"><a href="#__codelineno-40-23">23</a></span>
<span class="normal"><a href="#__codelineno-40-24">24</a></span>
<span class="normal"><a href="#__codelineno-40-25">25</a></span>
<span class="normal"><a href="#__codelineno-40-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="k">internal</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="p">{</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">startCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">    </span><span class="n">Framework</span><span class="p">.</span><span class="n">Run</span><span class="p">(</span><span class="n">View</span><span class="p">,</span><span class="w"> </span><span class="n">CounterRules</span><span class="p">.</span><span class="n">Update</span><span class="p">,</span><span class="w"> </span><span class="n">startCounter</span><span class="p">);</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">View</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Counter: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Please enter a command:&quot;</span><span class="p">);</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;(I)ncrement, (D)ecrement, (R)eset, (Q)uit&quot;</span><span class="p">);</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">()</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">ConvertStringToCommand</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ConvertStringToCommand</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">ToLower</span><span class="p">().</span><span class="n">Trim</span><span class="p">()</span><span class="w"> </span><span class="k">switch</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="w">    </span><span class="s">&quot;i&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IncrementCommand</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="w">    </span><span class="s">&quot;d&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DecrementCommand</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a><span class="w">    </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResetCommand</span><span class="p">(),</span>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a><span class="w">    </span><span class="s">&quot;q&quot;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QuitCommand</span><span class="p">(),</span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a><span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnknownCommand</span><span class="p">(),</span>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">CounterRules.cs</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CounterRules</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="p">{</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Tag</span><span class="w"> </span><span class="k">switch</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">      </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Increment</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">IncrementCommand</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">      </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Decrement</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DecrementCommand</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="n">Value</span><span class="p">,</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="w">      </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Reset</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">      </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Quit</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">      </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Unknown</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">      </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">model</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Commands.cs</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span>
<span class="normal"><a href="#__codelineno-42-32">32</a></span>
<span class="normal"><a href="#__codelineno-42-33">33</a></span>
<span class="normal"><a href="#__codelineno-42-34">34</a></span>
<span class="normal"><a href="#__codelineno-42-35">35</a></span>
<span class="normal"><a href="#__codelineno-42-36">36</a></span>
<span class="normal"><a href="#__codelineno-42-37">37</a></span>
<span class="normal"><a href="#__codelineno-42-38">38</a></span>
<span class="normal"><a href="#__codelineno-42-39">39</a></span>
<span class="normal"><a href="#__codelineno-42-40">40</a></span>
<span class="normal"><a href="#__codelineno-42-41">41</a></span>
<span class="normal"><a href="#__codelineno-42-42">42</a></span>
<span class="normal"><a href="#__codelineno-42-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">CommandType</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="p">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">  </span><span class="n">Increment</span><span class="p">,</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">  </span><span class="n">Decrement</span><span class="p">,</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">  </span><span class="n">Reset</span><span class="p">,</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">  </span><span class="n">Quit</span><span class="p">,</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">  </span><span class="n">Unknown</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="p">}</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">IncrementCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="p">{</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Increment</span><span class="p">;</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">init</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="nf">IncrementCommand</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="p">}</span>
<a id="__codelineno-42-19" name="__codelineno-42-19"></a>
<a id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DecrementCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-42-21" name="__codelineno-42-21"></a><span class="p">{</span>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Decrement</span><span class="p">;</span>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">init</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="nf">DecrementCommand</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-42-25" name="__codelineno-42-25"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="w">    </span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
<a id="__codelineno-42-27" name="__codelineno-42-27"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-42-28" name="__codelineno-42-28"></a><span class="p">}</span>
<a id="__codelineno-42-29" name="__codelineno-42-29"></a>
<a id="__codelineno-42-30" name="__codelineno-42-30"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ResetCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a><span class="p">{</span>
<a id="__codelineno-42-32" name="__codelineno-42-32"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Reset</span><span class="p">;</span>
<a id="__codelineno-42-33" name="__codelineno-42-33"></a><span class="p">}</span>
<a id="__codelineno-42-34" name="__codelineno-42-34"></a>
<a id="__codelineno-42-35" name="__codelineno-42-35"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">QuitCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-42-36" name="__codelineno-42-36"></a><span class="p">{</span>
<a id="__codelineno-42-37" name="__codelineno-42-37"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Quit</span><span class="p">;</span>
<a id="__codelineno-42-38" name="__codelineno-42-38"></a><span class="p">}</span>
<a id="__codelineno-42-39" name="__codelineno-42-39"></a>
<a id="__codelineno-42-40" name="__codelineno-42-40"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UnknownCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">CommandType</span><span class="o">&gt;</span>
<a id="__codelineno-42-41" name="__codelineno-42-41"></a><span class="p">{</span>
<a id="__codelineno-42-42" name="__codelineno-42-42"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">CommandType</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CommandType</span><span class="p">.</span><span class="n">Unknown</span><span class="p">;</span>
<a id="__codelineno-42-43" name="__codelineno-42-43"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Framework.cs</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span>
<span class="normal"><a href="#__codelineno-43-24">24</a></span>
<span class="normal"><a href="#__codelineno-43-25">25</a></span>
<span class="normal"><a href="#__codelineno-43-26">26</a></span>
<span class="normal"><a href="#__codelineno-43-27">27</a></span>
<span class="normal"><a href="#__codelineno-43-28">28</a></span>
<span class="normal"><a href="#__codelineno-43-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Command</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Enum</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="p">{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Tag</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="p">}</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Framework</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="p">{</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Run</span><span class="o">&lt;</span><span class="n">TModel</span><span class="p">,</span><span class="w"> </span><span class="n">TCommandType</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">      </span><span class="n">Func</span><span class="o">&lt;</span><span class="n">TModel</span><span class="p">,</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">TCommandType</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">view</span><span class="p">,</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">      </span><span class="n">Func</span><span class="o">&lt;</span><span class="n">TModel</span><span class="p">,</span><span class="w"> </span><span class="n">Command</span><span class="o">&lt;</span><span class="n">TCommandType</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">TModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">update</span><span class="p">,</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="w">      </span><span class="n">TModel</span><span class="w"> </span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">TCommandType</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Enum</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Enum</span><span class="p">.</span><span class="n">IsDefined</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TCommandType</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Quit&quot;</span><span class="p">))</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">&quot;Command must have a Quit option&quot;</span><span class="p">);</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">quitCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enum</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TCommandType</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Quit&quot;</span><span class="p">);</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">currentModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="p">(</span><span class="n">currentModel</span><span class="p">);</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="w">    </span><span class="k">do</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a><span class="w">      </span><span class="n">currentModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">(</span><span class="n">currentModel</span><span class="p">,</span><span class="w"> </span><span class="n">command</span><span class="p">);</span>
<a id="__codelineno-43-25" name="__codelineno-43-25"></a><span class="w">      </span><span class="n">Console</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a><span class="w">      </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view</span><span class="p">(</span><span class="n">currentModel</span><span class="p">);</span>
<a id="__codelineno-43-27" name="__codelineno-43-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">command</span><span class="p">.</span><span class="n">Tag</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">quitCommand</span><span class="p">));</span>
<a id="__codelineno-43-28" name="__codelineno-43-28"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-43-29" name="__codelineno-43-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="conclusion"><a class="toclink" href="../../2025/12/01/reducing-bugs-by-using-the-model-view-update-pattern/#conclusion">Conclusion</a></h3>
<p>In this post, we built out a basic application using the Model View Update pattern that was first introduced by the Elm language. We also implemented a basic sum type, <code>Command</code>, using an abstract class that was then constrained to particular <code>CommandTypes</code>.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2025-05-27 00:00:00+00:00">May 27, 2025</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../typescript/" class="md-meta__link">TypeScript</a>, 
              <a href="./" class="md-meta__link">Functional Programming</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="simplifying-console-logic-with-the-model-view-update"><a class="toclink" href="../../2025/05/27/simplifying-console-logic-with-the-model-view-update/">Simplifying Console Logic with the Model-View-Update</a></h2>
<p>When I first started dabbling in Functional Programming, a new front-end language called <a href="https://elm-lang.org/">Elm</a> had been released and it was generating a lot of buzz about how it simplified web development by introducing four parts (i.e., The Elm Architecture" (TEA)) that provided a mental model when creating web pages. This way of thinking was so powerful that it inspired popular libraries like <a href="https://redux.js.org/understanding/history-and-design/prior-art#elm">Redux</a> and <a href="https://ngrx.io/docs">ngrx</a> which took this architecture mainstream.</p>
<h3 id="spilling-the-tea"><a class="toclink" href="../../2025/05/27/simplifying-console-logic-with-the-model-view-update/#spilling-the-tea">Spilling the TEA</a></h3>
<p>At a high level, the architecture has four parts:</p>
<ol>
<li>Model -&gt; What are we rendering?</li>
<li>View -&gt; How do we want to render it?</li>
<li>Update -&gt; Given the current model and a Command, what's the new model?</li>
<li>Command -&gt; What did the user do?</li>
</ol>
<p>To help make this a bit more clear, let's define some types for these parts and see how they would work together</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">any</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kr">type</span><span class="w"> </span><span class="nx">View</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="o">:</span><span class="kt">Model</span><span class="p">)=&gt;</span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="o">:</span><span class="kt">Command</span><span class="p">)=&gt;</span><span class="nx">Model</span><span class="p">;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;firstOption&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;secondOption&quot;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="p">;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">view</span><span class="o">:</span><span class="kt">View</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="o">:</span><span class="kt">Update</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="p">){</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">);</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">main</span><span class="p">(</span><span class="nx">newModel</span><span class="p">);</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With some types in play, let's go ahead and build out a small application, a counter (the "Hello World" for Elm).</p>
<h3 id="building-a-counter"><a class="toclink" href="../../2025/05/27/simplifying-console-logic-with-the-model-view-update/#building-a-counter">Building a Counter</a></h3>
<p>First, we need to figure out what the model will be. Since we're only keeping tracking of a number, we can define our model as a number.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Next, we need to define what the user can do. In this case, they can either <em>increment</em>, <em>decrement</em>, or <em>quit</em> so let's set the command up.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;increment&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;decrement&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Now that we have <code>Command</code>, we can work on the <code>update</code> function. Given the type signature from before, we know its going to look like this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="kt">Command</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">  </span><span class="c1">// logic</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We can leverage a <code>switch</code> and put in our business rules</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span>
<span class="normal"><a href="#__codelineno-30-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="kt">Command</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">  </span><span class="k">switch</span><span class="p">(</span><span class="nx">command</span><span class="p">){</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;increment&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="o">+</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;decrement&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="p">;</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, we need to define our <code>view</code> function. Like before, we can get the skeleton for the function based on the types from earlier.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Let's update the function with our rendering logic</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Counter:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Choose to (i)ncrement, (d)ecrement, or (q)uit&quot;</span><span class="p">);</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We've got our render up and running, however, we need to get input from the user. Since we're working within Node, we could use <a href="https://nodejs.org/api/readline.html">readline</a>, however, I've recently been using <a href="https://www.npmjs.com/package/@inquirer/prompts">@inquirer/prompts</a> and find it to be a nice abstraction to use. So let's use that package.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">input</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@inquirer/prompts&quot;</span><span class="p">;</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getChoice</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Choose to (i)ncrement, (d)ecrement, or (q)uit&quot;</span><span class="p">);</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validChoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="p">];</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">validChoices</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">s</span><span class="o">?</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">());</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">input</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span><span class="kt">message</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="o">:</span><span class="kt">validator</span><span class="p">});</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;i&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;increment&quot;</span><span class="p">;</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">){</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;decrement&quot;</span><span class="p">;</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;terminate&quot;</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="p">}</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="c1">// Let&#39;s change the view function to use getChoice</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Counter:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">getChoice</span><span class="p">();</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With these pieces defined, we can use the <code>main</code> function from before.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">view</span><span class="o">:</span><span class="kt">View</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="o">:</span><span class="kt">Update</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="p">){</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">);</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">main</span><span class="p">(</span><span class="nx">newModel</span><span class="p">);</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="p">}</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="c1">// Invoking Main</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="nx">main</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">view</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="starting-back-at-zero"><a class="toclink" href="../../2025/05/27/simplifying-console-logic-with-the-model-view-update/#starting-back-at-zero">Starting Back at Zero</a></h3>
<p>Now that we have increment and decrement working, it would be nice to be able to reset the counter without having to restart the application, so let's see how bad that would be.</p>
<p>First, we need to add a new choice to <code>Command</code> (called <em>reset</em>). This will force us to update the rest of the code that's working with <code>Command</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;increment&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;decrement&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;reset&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;quit&quot;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Next, we need to update the <code>update</code> function so it knows how to handle a <code>reset</code> command. In our case, we need to set the model back to zero.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span>
<span class="normal"><a href="#__codelineno-36-4">4</a></span>
<span class="normal"><a href="#__codelineno-36-5">5</a></span>
<span class="normal"><a href="#__codelineno-36-6">6</a></span>
<span class="normal"><a href="#__codelineno-36-7">7</a></span>
<span class="normal"><a href="#__codelineno-36-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="kt">Command</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">  </span><span class="k">switch</span><span class="p">(</span><span class="nx">command</span><span class="p">){</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;increment&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="o">+</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;decrement&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;reset&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="p">;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>At this point, the application knows how to handle the new <code>Command</code>, however, we need to update our <code>view</code> function to allow the user to select reset.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Counter:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">getChoice</span><span class="p">();</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="p">}</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getChoice</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">  </span><span class="c1">// updating the console.log</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Choose to (i)ncrement, (d)ecrement, (r)eset, or (q)uit&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validChoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="p">];</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">validChoices</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">s</span><span class="o">?</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">());</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">input</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span><span class="kt">message</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="o">:</span><span class="kt">validator</span><span class="p">});</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;i&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;increment&quot;</span><span class="p">;</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">){</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;decrement&quot;</span><span class="p">;</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="p">){</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;reset&quot;</span><span class="p">;</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;terminate&quot;</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="whats-next"><a class="toclink" href="../../2025/05/27/simplifying-console-logic-with-the-model-view-update/#whats-next">What's Next?</a></h3>
<p>Now that we have have a working version, you could start implementing some fun functionality. For example, how would you allow someone to set how much to increment or decrement by? What if you needed to keep track of previous values (i.e., maintaining history)? I highly encourage you trying this out with a simple kata (for example, how about giving <a href="../../2020/05/20/mars-rover---defining-the-problem/#problem-description">Mars Rover</a> a try?)</p>
<h3 id="full-working-solution"><a class="toclink" href="../../2025/05/27/simplifying-console-logic-with-the-model-view-update/#full-working-solution">Full Working Solution</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span>
<span class="normal"><a href="#__codelineno-38-22">22</a></span>
<span class="normal"><a href="#__codelineno-38-23">23</a></span>
<span class="normal"><a href="#__codelineno-38-24">24</a></span>
<span class="normal"><a href="#__codelineno-38-25">25</a></span>
<span class="normal"><a href="#__codelineno-38-26">26</a></span>
<span class="normal"><a href="#__codelineno-38-27">27</a></span>
<span class="normal"><a href="#__codelineno-38-28">28</a></span>
<span class="normal"><a href="#__codelineno-38-29">29</a></span>
<span class="normal"><a href="#__codelineno-38-30">30</a></span>
<span class="normal"><a href="#__codelineno-38-31">31</a></span>
<span class="normal"><a href="#__codelineno-38-32">32</a></span>
<span class="normal"><a href="#__codelineno-38-33">33</a></span>
<span class="normal"><a href="#__codelineno-38-34">34</a></span>
<span class="normal"><a href="#__codelineno-38-35">35</a></span>
<span class="normal"><a href="#__codelineno-38-36">36</a></span>
<span class="normal"><a href="#__codelineno-38-37">37</a></span>
<span class="normal"><a href="#__codelineno-38-38">38</a></span>
<span class="normal"><a href="#__codelineno-38-39">39</a></span>
<span class="normal"><a href="#__codelineno-38-40">40</a></span>
<span class="normal"><a href="#__codelineno-38-41">41</a></span>
<span class="normal"><a href="#__codelineno-38-42">42</a></span>
<span class="normal"><a href="#__codelineno-38-43">43</a></span>
<span class="normal"><a href="#__codelineno-38-44">44</a></span>
<span class="normal"><a href="#__codelineno-38-45">45</a></span>
<span class="normal"><a href="#__codelineno-38-46">46</a></span>
<span class="normal"><a href="#__codelineno-38-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">input</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@inquirer/prompts&quot;</span><span class="p">;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;increment&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;decrement&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;reset&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;quit&quot;</span><span class="p">;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="kr">type</span><span class="w"> </span><span class="nx">View</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="kt">Command</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">Model</span><span class="p">;</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="kd">function</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="o">:</span><span class="kt">Command</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Model</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="w">  </span><span class="k">switch</span><span class="p">(</span><span class="nx">command</span><span class="p">){</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;increment&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="o">+</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;decrement&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;reset&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;quit&quot;</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">model</span><span class="p">;</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="p">}</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="kd">function</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Counter:</span><span class="si">${</span><span class="nx">model</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">getChoice</span><span class="p">();</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="p">}</span>
<a id="__codelineno-38-21" name="__codelineno-38-21"></a>
<a id="__codelineno-38-22" name="__codelineno-38-22"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">getChoice</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Command</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-38-23" name="__codelineno-38-23"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Choose to (i)ncrement, (d)ecrement, (r)eset, or (q)uit&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-38-24" name="__codelineno-38-24"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validChoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;q&quot;</span><span class="p">];</span>
<a id="__codelineno-38-25" name="__codelineno-38-25"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">validChoices</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">s</span><span class="o">?</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">());</span>
<a id="__codelineno-38-26" name="__codelineno-38-26"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">input</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span><span class="kt">message</span><span class="p">,</span><span class="w"> </span><span class="nx">validate</span><span class="o">:</span><span class="kt">validator</span><span class="p">});</span>
<a id="__codelineno-38-27" name="__codelineno-38-27"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;i&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-28" name="__codelineno-38-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;increment&quot;</span><span class="p">;</span>
<a id="__codelineno-38-29" name="__codelineno-38-29"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;d&quot;</span><span class="p">){</span>
<a id="__codelineno-38-30" name="__codelineno-38-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;decrement&quot;</span><span class="p">;</span>
<a id="__codelineno-38-31" name="__codelineno-38-31"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selection</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="p">){</span>
<a id="__codelineno-38-32" name="__codelineno-38-32"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;reset&quot;</span><span class="p">;</span>
<a id="__codelineno-38-33" name="__codelineno-38-33"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-34" name="__codelineno-38-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;terminate&quot;</span>
<a id="__codelineno-38-35" name="__codelineno-38-35"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-38-36" name="__codelineno-38-36"></a><span class="p">}</span>
<a id="__codelineno-38-37" name="__codelineno-38-37"></a>
<a id="__codelineno-38-38" name="__codelineno-38-38"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">(</span><span class="nx">model</span><span class="o">:</span><span class="kt">Model</span><span class="p">,</span><span class="w"> </span><span class="nx">view</span><span class="o">:</span><span class="kt">View</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="o">:</span><span class="kt">Update</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-38-39" name="__codelineno-38-39"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">view</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-38-40" name="__codelineno-38-40"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">command</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;quit&#39;</span><span class="p">){</span>
<a id="__codelineno-38-41" name="__codelineno-38-41"></a><span class="w">    </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-38-42" name="__codelineno-38-42"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-38-43" name="__codelineno-38-43"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">newModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">update</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span><span class="w"> </span><span class="nx">command</span><span class="p">);</span>
<a id="__codelineno-38-44" name="__codelineno-38-44"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">main</span><span class="p">(</span><span class="nx">newModel</span><span class="p">,</span><span class="w"> </span><span class="nx">view</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">);</span>
<a id="__codelineno-38-45" name="__codelineno-38-45"></a><span class="p">}</span>
<a id="__codelineno-38-46" name="__codelineno-38-46"></a>
<a id="__codelineno-38-47" name="__codelineno-38-47"></a><span class="nx">main</span><span class="p">(</span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="nx">view</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-09-04 00:00:00+00:00">Sep 4, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../typescript/" class="md-meta__link">TypeScript</a>, 
              <a href="./" class="md-meta__link">Functional Programming</a></li>
        
        
          
          <li class="md-meta__item">
            
              8 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="functional-design-patterns-missing-values"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/">Functional Design Patterns - Missing Values</a></h2>
<p>When working in software, a common problem that we run into is what should we do if we can't get a value or compute an answer.</p>
<p>For example, let's say that you go to the library to checkout the latest book from <a href="https://www.nathaliaholt.com/">Nathalia Holt</a>, but when you search for it, you realize that they don't have any copies in stock.</p>
<p>How do you handle the absence of value? From an Object Oriented Programming (OOP), you might be able to leverage a reasonable default or the <a href="https://refactoring.guru/introduce-null-object">Null Object Pattern</a>. Another approach would be to return to always return a list and if there are no values, then the list would be empty.</p>
<p>No matter the choice you make, we need some way to model the lack of a value. <a href="https://en.wikipedia.org/wiki/Tony_Hoare">Tony Hoare referred to null as his billion dollar mistake</a> as its inclusion in languages have created countless bugs and errors.</p>
<p>In most functional languages, the idea of <code>null</code> doesn't exist, so how do they handle missing values?</p>
<h3 id="revisiting-functions"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#revisiting-functions">Revisiting Functions</a></h3>
<p>In <a href="../../2024/05/30/functional-foundations---functions/#what-is-a-function">a previous post</a>, we mention that a function is a mapping between two sets such that every element on the left (first set) is mapped to a single element on the right (the second set). So what happens when we have a mapping that's not a function?</p>
<p>In these cases, we have two solutions to choose from:</p>
<ol>
<li>Restrict the function input to only be values that can be mapped (e.g., restrict the domain)</li>
<li>Expand the possible values that the function can map to (e.g., expand the range)</li>
</ol>
<p>When refactoring a mapping, I tend to stick with option 1 because if we can prevent bad data from being created or passed in, that's less error handling that needs to be written and it becomes simpler to reason about. However, there are plenty of times where our type system (or business rules) can't enforce the valid inputs.</p>
<h3 id="number-math"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#number-math">Number Math</a></h3>
<p>Let's say that we're working on a "word calculator" where the user can enter a phrase like "one thousand twelve" and it returns "1012" as output. If we think about our input set (domain) and outputs, we would have the following (mapping from string to number).</p>
<p><img alt="Mapping from string to number" src="https://softwarementorblog.blob.core.windows.net/images/functional-missing-values/initial-mapping.png" width="750px" /></p>
<p>The issue is that we can't guarantee that the strings the user gives us would represent a number (for example, how would you convert "platypus" to a number?)</p>
<p>Since we can't restrict the input, we have to expand the output. So let's update our output to be <code>number | 'invalid'</code> </p>
<p><img alt="Mapping from string to number or 'invalid'" src="https://softwarementorblog.blob.core.windows.net/images/functional-missing-values/updated-mapping.png" width="750px" /></p>
<p>With this change, anytime we call <code>convertToNumber</code>, we'll need to add some handling on what to do if the output is <code>invalid</code>. </p>
<p>Here's some pseudocode of what this mapping could look like</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">WordCalculatorResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s1">&#39;invalid&#39;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="kd">function</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="nx">phrase</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">WorldCalculatorResult</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;two&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="c1">// ... other logic</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;invalid&#39;</span><span class="p">;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="p">}</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">convertToNumber</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">));</span><span class="w"> </span><span class="c1">// prints &quot;1&quot;;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">convertToNumber</span><span class="p">(</span><span class="s1">&#39;kumquats&#39;</span><span class="p">))</span><span class="w"> </span><span class="c1">// prints invalid</span>
</code></pre></div></td></tr></table></div>
<h3 id="leaky-context"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#leaky-context">Leaky Context</a></h3>
<p>So far, so good as we have a <em>function</em> that converts words to numbers. Let's now say that we want to square a number. Writing such a function is straightforward.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">square</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="o">*</span><span class="nx">x</span><span class="p">;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With both <code>convertToNumber</code> and <code>square</code> defined, let's try to combine these together: </p>
<p><img alt="Compilation error when combining convertToNumber and Square" src="https://softwarementorblog.blob.core.windows.net/images/functional-missing-values/compilation-error.png" /></p>
<p>This doesn't work because <code>convertToNumber</code> can return <code>invalid</code> which there's no way for the <code>square</code> function to work with that. Due to this limitation, we could rewrite the code to check for <code>invalid</code> before calling <code>square</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">);</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">square</span><span class="p">(</span><span class="nx">result</span><span class="p">));</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This approach will work, but the downside is that we need to add error handling logic in our pipeline now. If this was the only place where it's being used, then it's not too bad. However, if we were using <code>convertToNumber</code> in multiple places, then we have to remember to add this error handling logic. In fact, we would have almost the same <code>if</code> check everywhere.</p>
<p>Let's take a look at a different way of solving this problem by using the Maybe type.</p>
<h3 id="introducing-the-maybe-type"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#introducing-the-maybe-type">Introducing the Maybe Type</a></h3>
<p>In our original approach, we already had a type called <code>WordCalculatorResult</code> for the computation. Instead of it being a number or <code>invalid</code>, we could instead create a new type, called <code>Maybe</code> that looks like the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;some&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>By leveraging generics and tagged unions, we have a way to represent a missing value for any type. With this new definition, we can rewrite the <code>convertToNumber</code> function to use the Maybe type.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="nx">phrase</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="kt">number</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">label</span><span class="o">:</span><span class="s1">&#39;some&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="kt">1</span><span class="p">};</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;two&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">label</span><span class="o">:</span><span class="s1">&#39;some&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="kt">2</span><span class="p">};</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="c1">// other logic</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">label</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">};</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>I don't know about you, but typing out <code>{label:'some'}</code> is going to get tiring, so let's create two helper functions, <code>some</code> and <code>none</code> that handle putting the right label if we have a value or not.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span>
<span class="normal"><a href="#__codelineno-18-6">6</a></span>
<span class="normal"><a href="#__codelineno-18-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">some</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">label</span><span class="o">:</span><span class="s1">&#39;some&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">};</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="p">}</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="kd">function</span><span class="w"> </span><span class="nx">none</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">label</span><span class="o">:</span><span class="s1">&#39;none&#39;</span><span class="p">};</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Which allows us to replace all of the <code>{label:'some', value:x}</code> with <code>some(x)</code> and <code>{label:'none'}</code> with <code>none()</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="nx">phrase</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="kt">number</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">some</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;two&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">some</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="c1">// other logic</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">none</span><span class="p">();</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Now that <code>convertToNumber</code> returns a Maybe, our pipeline would look like the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span>
<span class="normal"><a href="#__codelineno-20-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">);</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">label</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;some&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// checking if we&#39;re a Some type</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">square</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="introducing-transformations-with-map"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#introducing-transformations-with-map">Introducing Transformations With Map</a></h3>
<p>Now the problem we're wanting to solve is to get rid of having to do an if check on <code>some</code> in order to call the <code>square</code> function. Given that we're wanting to transform our number into a different number, we can write another function, called <code>map</code> that takes two parameters: the <code>Maybe</code> we want transformed and the function that knows how to transform it. Let's take a look at how to write such a function.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span>
<span class="normal"><a href="#__codelineno-21-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">map</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span><span class="nx">U</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">m</span><span class="o">:</span><span class="kt">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="nx">f</span><span class="o">:</span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="kt">T</span><span class="p">)=&gt;</span><span class="nx">U</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">U</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">label</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;some&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Is Maybe a Some?</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">transformedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span><span class="w"> </span><span class="c1">// Grab the value and transform it by calling function f</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">some</span><span class="p">(</span><span class="nx">transformedValue</span><span class="p">)</span><span class="w"> </span><span class="c1">// return a new Maybe with the transformed value</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">none</span><span class="p">();</span><span class="w"> </span><span class="c1">// Return none since there&#39;s no value to transform</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With <code>map</code> implemented, let's update our code to use it!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">convertResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// </span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">transformedResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">map</span><span class="p">(</span><span class="nx">convertResult</span><span class="p">,</span><span class="w"> </span><span class="nx">square</span><span class="p">);</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">transformedResult</span><span class="p">.</span><span class="nx">label</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;some&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// checking if we&#39;re a Some type</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">transformedResult</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="p">}</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="cm">/* The above could be simplified as the following</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="cm">const result = map(convertToNumber(&#39;one&#39;), square);</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="cm">if (result.label === &#39;some&#39;) {</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="cm">  console.log(result.value)</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="cm">}</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="cm">*/</span>
</code></pre></div></td></tr></table></div>
<p>Thanks to <code>map</code> and <code>Maybe</code>, we're able to write two pure functions (<code>convertToNumber</code> and <code>square</code>), glue them together, and delegate our error handling to one spot (instead of having to sprinkle this throughout the codebase). </p>
<h3 id="calling-side-affects-using-tee"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#calling-side-affects-using-tee">Calling Side Affects Using Tee</a></h3>
<p>With the addition of <code>map</code>, we've now simplified our <code>if</code> check to only call <code>console.log</code> now (instead of calling the square function then console.log). If we wanted to truly get rid of this if statement, then we need a way to invoke the <code>console.log</code> as a side effect. We don't want to combine <code>console.log</code> into <code>square</code> because <code>square</code> is business rules and we don't want to add side effect logic to our business rules.</p>
<p>Similar to what we did for <code>map</code>, let's add a new function, called <code>tee</code>, that takes in three arguments: a <code>Maybe</code>, a function to call if the <code>Maybe</code> has a value, and then a function to call if <code>Maybe</code> doesn't have a value.</p>
<p>Let's take a look at what an implementation would look like:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="cm">/*</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="cm"> Inputs:</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="cm">    m: A Maybe to work with</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="cm">    ifSome: A function that takes in a T (which comes from the Maybe) and returns void</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="cm">    ifNone: A function that takes no inputs and returns void</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="cm"> Outputs:</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="cm">    Returns m so that we can continue chaining calls</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="cm">*/</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="kd">function</span><span class="w"> </span><span class="nx">tee</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">m</span><span class="o">:</span><span class="kt">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="nx">ifSome</span><span class="o">:</span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="kt">T</span><span class="p">)=&gt;</span><span class="ow">void</span><span class="p">,</span><span class="w"> </span><span class="nx">ifNone</span><span class="o">:</span><span class="p">()=&gt;</span><span class="ow">void</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">label</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;some&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">        </span><span class="nx">ifSome</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">        </span><span class="nx">ifNone</span><span class="p">();</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">m</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With <code>tee</code> implemented, we can update our pipeline to take advantage of it:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">convertResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// </span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">transformedResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">map</span><span class="p">(</span><span class="nx">convertResult</span><span class="p">,</span><span class="w"> </span><span class="nx">square</span><span class="p">);</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">ifSome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Result is </span><span class="si">${</span><span class="nx">t</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">ifNone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Failed to calculate result.&#39;</span><span class="p">);</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="nx">tee</span><span class="p">(</span><span class="nx">transformedResult</span><span class="p">,</span><span class="w"> </span><span class="nx">ifSome</span><span class="p">,</span><span class="w"> </span><span class="nx">ifNone</span><span class="p">);</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="c1">// if we wanted to get rid of the temp values, we could do the following</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="c1">// const result = tee(map(convertToNumber(&#39;one&#39;), square)), ifSome, ifNone);</span>
</code></pre></div></td></tr></table></div>
<h3 id="cleaning-up-by-using-an-object"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#cleaning-up-by-using-an-object">Cleaning Up by using an Object</a></h3>
<p>We've now centralized the <code>if</code> logic to the functions that work on <code>Maybe</code>s which is helpful, but as we're already seeing, the code can be hard to parse as you need to read from the outside in (which is very Clojure or Scheme in nature).</p>
<p>Instead of building up functions this way, we can instead create a TypeScript class and use a <a href="https://en.wikipedia.org/wiki/Fluent_interface#Examples"><code>fluent interface</code> pattern</a> by doing the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span>
<span class="normal"><a href="#__codelineno-25-29">29</a></span>
<span class="normal"><a href="#__codelineno-25-30">30</a></span>
<span class="normal"><a href="#__codelineno-25-31">31</a></span>
<span class="normal"><a href="#__codelineno-25-32">32</a></span>
<span class="normal"><a href="#__codelineno-25-33">33</a></span>
<span class="normal"><a href="#__codelineno-25-34">34</a></span>
<span class="normal"><a href="#__codelineno-25-35">35</a></span>
<span class="normal"><a href="#__codelineno-25-36">36</a></span>
<span class="normal"><a href="#__codelineno-25-37">37</a></span>
<span class="normal"><a href="#__codelineno-25-38">38</a></span>
<span class="normal"><a href="#__codelineno-25-39">39</a></span>
<span class="normal"><a href="#__codelineno-25-40">40</a></span>
<span class="normal"><a href="#__codelineno-25-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="k">export</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="p">{</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="kr">constructor</span><span class="p">(</span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="kt">T</span><span class="o">|</span><span class="kc">undefined</span><span class="o">=</span><span class="kc">undefined</span><span class="p">){}</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">  </span><span class="nx">map</span><span class="o">&lt;</span><span class="nx">U</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">f</span><span class="o">:</span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="kt">T</span><span class="p">)=&gt;</span><span class="nx">U</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">U</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">.</span><span class="nx">none</span><span class="p">();</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">  </span><span class="nx">tee</span><span class="p">(</span><span class="nx">ifSome</span><span class="o">:</span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="kt">T</span><span class="p">)=&gt;</span><span class="ow">void</span><span class="p">,</span><span class="w"> </span><span class="nx">ifNone</span><span class="o">:</span><span class="p">()=&gt;</span><span class="ow">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">undefined</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">      </span><span class="nx">ifSome</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">      </span><span class="nx">ifNone</span><span class="p">();</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">some</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="nx">none</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">();</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="p">}</span>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="c1">// Defined in index.ts</span>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a><span class="kd">function</span><span class="w"> </span><span class="nx">convertToNumber</span><span class="p">(</span><span class="nx">phrase</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Maybe</span><span class="o">&lt;</span><span class="kt">number</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;one&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">phrase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;two&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<a id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="w">    </span><span class="c1">// other logic</span>
<a id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Maybe</span><span class="p">.</span><span class="nx">none</span><span class="p">();</span>
<a id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="p">}</span>
<a id="__codelineno-25-29" name="__codelineno-25-29"></a>
<a id="__codelineno-25-30" name="__codelineno-25-30"></a><span class="kd">function</span><span class="w"> </span><span class="nx">square</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="o">*</span><span class="nx">x</span><span class="p">;</span>
<a id="__codelineno-25-32" name="__codelineno-25-32"></a><span class="p">}</span>
<a id="__codelineno-25-33" name="__codelineno-25-33"></a>
<a id="__codelineno-25-34" name="__codelineno-25-34"></a><span class="c1">// By using the fluent interface pattern, we can chain methods together and have this code read</span>
<a id="__codelineno-25-35" name="__codelineno-25-35"></a><span class="c1">// more naturally</span>
<a id="__codelineno-25-36" name="__codelineno-25-36"></a><span class="nx">convertToNumber</span><span class="p">(</span><span class="s2">&quot;one&quot;</span><span class="p">)</span>
<a id="__codelineno-25-37" name="__codelineno-25-37"></a><span class="w">  </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">square</span><span class="p">)</span>
<a id="__codelineno-25-38" name="__codelineno-25-38"></a><span class="w">  </span><span class="p">.</span><span class="nx">tee</span><span class="p">(</span>
<a id="__codelineno-25-39" name="__codelineno-25-39"></a><span class="w">    </span><span class="p">(</span><span class="nx">v</span><span class="p">)=&gt;</span><span class="w"> </span><span class="sb">`Answer is </span><span class="si">${</span><span class="nx">v</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-25-40" name="__codelineno-25-40"></a><span class="w">    </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s2">&quot;Unable to calculate result&quot;</span>
<a id="__codelineno-25-41" name="__codelineno-25-41"></a><span class="w">  </span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="wrapping-up"><a class="toclink" href="../../2024/09/04/functional-design-patterns---missing-values/#wrapping-up">Wrapping Up</a></h3>
<p>When writing software, a common problem we run into is what to do when we can't calculate a value or a result. In this post, we looked at techniques to restrict the function's input or expand their output to handle scenarios. From there, we looked into a type called Maybe and how it can represent the absence of value, but still provide a way to remove having to explicitly write error handling code by consolidating the checks into a <code>map</code> call. Lastly, we look into taking the various functions that we wrote and combine them into a formal <code>Maybe</code> class that allows us to leverage a fluent interface and chain our interactions together.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-08-27 00:00:00+00:00">Aug 27, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../typescript/" class="md-meta__link">TypeScript</a>, 
              <a href="./" class="md-meta__link">Functional Programming</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="functional-design-patterns-reduce-and-monoids"><a class="toclink" href="../../2024/08/27/functional-design-patterns---reduce-and-monoids/">Functional Design Patterns - Reduce and Monoids</a></h2>
<p>When learning about a loops, a common exercise is to take an array of elements and calculate some value based on them.  For example, let's say that we have an array of numbers and we want to find their sum. One approach would be the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">val</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">val</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This code works and we'll get the right answer, however, there's a pattern sitting here. If you find yourself writing code that has this shape (some initial value and some logic in the loop), then you have a <em>reducer</em> in disguise.</p>
<p>Let's convert this code to use the <em><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce">reduce</a></em> function instead.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span><span class="w"> </span><span class="nx">curr</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">curr</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>The <code>reduce</code> function takes two parameters, the <em>reducer</em> and the <em>initial value</em>. For the <em>initial value</em>, this is the value that the result should be if the array is empty. Since we're adding numbers together, zero makes the most sense.</p>
<p>The <em>reducer</em>, on the other hand, says that if you give me the accumulated result so far (called <em>acc</em> in the example) and an element from the array (called <em>curr</em> in the above example), what's the new accumulation?</p>
<p>Reduce is an extremely powerful tool (in fact, <a href="../../../presentations/#level-up-on-functional-programming-by-rebuilding-linq">I give a presentation where we rewrite some of C#'s LINQ operators as reduce</a>).</p>
<p>But there's another pattern sitting here. If you find that the initial value and elements of the array have the same type, you most likely have a <a href="https://en.wikipedia.org/wiki/Monoid">monoid</a>.</p>
<h3 id="intro-to-monoids"><a class="toclink" href="../../2024/08/27/functional-design-patterns---reduce-and-monoids/#intro-to-monoids">Intro to Monoids</a></h3>
<p>The concept of Monoid comes from the field of <a href="https://en.wikipedia.org/wiki/Category_theory">category theory</a> where a Monoid contains three things</p>
<ol>
<li>A set of values (you can think about this as a type)</li>
<li>Some binary operation (e.g., a function that takes two inputs and returns a single output of said type)</li>
<li>Some identity element such that if you pass the id to the binary operation, you get the other element back.</li>
</ol>
<p>There's a lot of theory sitting here, so let's put it in more concrete terms.</p>
<p>If we have a Monoid over the a type A, then the following must be true:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span>
<span class="normal"><a href="#__codelineno-15-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">operation</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="kt">A</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="kt">A</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="c1">// logic for operation</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="p">}</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">identity</span><span class="o">:</span><span class="w"> </span><span class="kt">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// some value of type A</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="nx">operation</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">identity</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">operation</span><span class="p">(</span><span class="nx">identity</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">x</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="nx">operation</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">operation</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">z</span><span class="p">))</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">operation</span><span class="p">(</span><span class="nx">operation</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">),</span><span class="w"> </span><span class="nx">z</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Here's how we would define such a thing in TypeScript.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">export</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">Monoid</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="kt">A</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="kt">A</span><span class="p">)=&gt;</span><span class="w"> </span><span class="nx">A</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="nx">identity</span><span class="o">:</span><span class="kt">A</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="exploring-total"><a class="toclink" href="../../2024/08/27/functional-design-patterns---reduce-and-monoids/#exploring-total">Exploring Total</a></h4>
<p>With more theory in place, let's apply it to our running total from before. It turns out that addition forms a Monoid over positive numbers with the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">additionOverNumber</span><span class="o">:</span><span class="w"> </span><span class="kt">Monoid</span><span class="o">&lt;</span><span class="kt">number</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="nx">identity</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Wait a minute... This looks like what the <code>reduce</code> function needed from before! </p>
<p>In the case where we have a Monoid, we have a way of reducing an array to a single value <em>for free</em> because of the properties that Monoid gives us.</p>
<h4 id="exploring-booleans"><a class="toclink" href="../../2024/08/27/functional-design-patterns---reduce-and-monoids/#exploring-booleans">Exploring Booleans</a></h4>
<p>Thankfully, we're not limited to just numbers. For example, let's take a look at booleans with the <code>&amp;&amp;</code> and <code>||</code> operators.</p>
<p>In the case of <code>&amp;&amp;</code>, that's our operation, so now we need to find the identity element. In other words, what value must <code>id</code> be if the following statements are true?</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="nx">id</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div></td></tr></table></div>
<p>Since <code>id</code> has to be a boolean, the answer is <code>true</code>. Therefore, we can define our Monoid like so</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">AndOverBoolean</span><span class="o">:</span><span class="w"> </span><span class="kt">Monoid</span><span class="o">&lt;</span><span class="kt">boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="nx">identity</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="kt">boolean</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="o">:</span><span class="kt">boolean</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">b</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With this monoid defined, let's put it to use. Let's say that we wanted to check if every number in a list is even. We could write the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">areAllEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span><span class="p">=&gt;</span><span class="nx">x</span><span class="o">%</span><span class="mf">2</span><span class="o">===</span><span class="mf">0</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">AndOverBoolean</span><span class="p">.</span><span class="nx">operation</span><span class="p">,</span><span class="w"> </span><span class="nx">AndOverBoolean</span><span class="p">.</span><span class="nx">identity</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Huh, that looks an awful lot like how we could have used <em><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every">every</a></em>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">areAllEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">x</span><span class="p">=&gt;</span><span class="nx">x</span><span class="o">%</span><span class="mf">2</span><span class="o">===</span><span class="mf">0</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Let's take a look at the <code>||</code> monoid now. We have the operation, but we now we need to find the identity. In other words, what value must <code>id</code> be if the following statements are true?</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nx">id</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="nx">id</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="kc">false</span>
</code></pre></div></td></tr></table></div>
<p>Since <code>id</code> has to be a boolean, the answer is <code>false</code>. Therefore, we can define our monoid as such.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">OrOverBoolean</span><span class="o">:</span><span class="w"> </span><span class="kt">Monoid</span><span class="o">&lt;</span><span class="kt">boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="nx">identity</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="kt">boolean</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="kt">boolean</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">y</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>
<p>With this monoid defined, let's put it to use. Let's say that we wanted to check if some number in a list is even. We could write the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">areAllEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span><span class="p">=&gt;</span><span class="nx">x</span><span class="o">%</span><span class="mf">2</span><span class="o">===</span><span class="mf">0</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">OrOverBoolean</span><span class="p">.</span><span class="nx">operation</span><span class="p">,</span><span class="w"> </span><span class="nx">OrOverBoolean</span><span class="p">.</span><span class="nx">identity</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Similar to the <code>AndOverBoolean</code>, this looks very similar to the code we would have written if we had leveraged <em><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some">some</a></em>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">];</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">isAnyEven</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">x</span><span class="o">%</span><span class="mf">2</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="wrapping-up"><a class="toclink" href="../../2024/08/27/functional-design-patterns---reduce-and-monoids/#wrapping-up">Wrapping Up</a></h3>
<p>When working with arrays of items, it's common to need to reduce the list down to a single element. You can start with a for loop and then refactor to using the reduce function. If the types are all the same, then it's likely that you also have a monoid, which can give you stronger guarantees about your code.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-05-30 00:00:00+00:00">May 30, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">Functional Programming</a>, 
              <a href="../typescript/" class="md-meta__link">TypeScript</a></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="functional-foundations-functions"><a class="toclink" href="../../2024/05/30/functional-foundations---functions/">Functional Foundations - Functions</a></h2>
<p>When leveraging functional programming, you're not going to go far without functions. It's literally in the name.</p>
<p>In this post, let's take a deeper look at what functions are and some of the benefits we gain.</p>
<h3 id="what-is-a-function"><a class="toclink" href="../../2024/05/30/functional-foundations---functions/#what-is-a-function">What is a Function?</a></h3>
<p>When we talk about <em>functions</em>, we're not talking about a programming construct (like the <code>function</code> keyword), but instead we're talking about functions from mathematics.</p>
<blockquote>
<p>As such, a <em>function</em> is a mapping from two sets such that for every element of the first set, it maps to a single element in the second set.</p>
</blockquote>
<p>Words are cool, but pictures are better. So let's look at the mapping for the <code>square</code> function.</p>
<p><img alt="Mapping for the Square Function" src="https://softwarementorblog.blob.core.windows.net/images/functional-functions/squaredFunction.png" width="800px" /></p>
<p>In this example, we have an arrow coming from an element on the left where it <em>maps</em> to an element on the right. To read this image, we have a mapping called <em>Square</em> that maps all possible numbers to the set of positive numbers. So -3 maps to 9 (-3<em>-3), 2 maps to 4 (2</em>2), so on and so forth.</p>
<p>To check if our mapping is a function, we need to check that every element on the left is mapped to a single element on the right. If so, then we've got a function!</p>
<p>Sounds easy, right? Let's take a look at a mapping that isn't a function.</p>
<h3 id="love-in-the-air"><a class="toclink" href="../../2024/05/30/functional-foundations---functions/#love-in-the-air">Love in the Air?</a></h3>
<p>When working with dates, it's common to figure out how many days are in the month. Not only does this help with billable days, but it also makes sure that we don't try to send invoices on May 32nd.</p>
<p>So let's take a look at a mapping from month to the number of days it has.</p>
<p><img alt="Broken Mapping for the Days In Month Function" src="https://softwarementorblog.blob.core.windows.net/images/functional-functions/daysInMonthBusted.png" width="800px" /></p>
<p>Looking at the mapping, we can tell that January, March, May map to 31, April and June both map to 30. But take a look at February. It's got <em>two</em> arrows coming out of it, one to 28 and the other to 29. Because there are two arrows coming out, this mapping isn't a function. Let's try to implement this mapping in TypeScript.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jan&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Feb&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Mar&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Apr&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;May&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Jun&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Jul&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Aug&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">           </span><span class="o">|</span><span class="s2">&quot;Sept&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Oct&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Nov&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Dec&quot;</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kr">type</span><span class="w"> </span><span class="nx">DaysInMonth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">28</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">29</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">30</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">31</span><span class="p">;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getDaysInMonth</span><span class="p">(</span><span class="nx">month</span><span class="o">:</span><span class="w"> </span><span class="kt">Month</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DaysInMonth</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">month</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Jan&quot;</span><span class="o">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Mar&quot;</span><span class="o">:</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;May&quot;</span><span class="o">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Jul&quot;</span><span class="o">:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Oct&quot;</span><span class="o">:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Dec&quot;</span><span class="o">:</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mf">31</span><span class="p">;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Feb&quot;</span><span class="o">:</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">      </span><span class="c1">// what should this be?</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Apr&quot;</span><span class="o">:</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Jun&quot;</span><span class="o">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Aug&quot;</span><span class="o">:</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Sept&quot;</span><span class="o">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Nov&quot;</span><span class="o">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mf">30</span><span class="p">;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We can't return 28 all the time (we'd be wrong 25% of the time) and we can't return 29 all the time (as we'd be wrong 75% of the time). So how do we know? We need to know something about the year. One approach would be to check if the current year is a leap year (<a href="https://learn.microsoft.com/en-us/office/troubleshoot/excel/determine-a-leap-year">algorithm</a>).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">isLeapYear</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">getFullYear</span><span class="p">();</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">400</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="p">}</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="c1">// Updated switch</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="k">case</span><span class="w"> </span><span class="s1">&#39;Feb&#39;</span><span class="o">:</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">isLeapYear</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">29</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">28</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>The problem with this approach is that the determination of what to return isn't from the function's inputs, but outside state (in this case, time). So while this "works", you can get bit when you have tests that start failing when the calendar flips over because it assumed that February always had 28 days.</p>
<p>If we look at the type signature of <code>isLeapYear</code>, we can see that it takes in no inputs, but returns a boolean. How can that be possible except if it always returned a constant value? This is a clue that <code>isLeapYear</code> is not a function.</p>
<p>The better approach is to change our mapping to instead of taking just a month name, it takes two arguments, a <code>monthName</code> and <code>year</code>.</p>
<p><img alt="Fixed Mapping For Days In Month" src="https://softwarementorblog.blob.core.windows.net/images/functional-functions/daysInMonthFixed.png" width="800px" /></p>
<p>With this new mapping, our implementation would look like the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">isLeapYear</span><span class="p">(</span><span class="nx">year</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">400</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">year</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="p">}</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kd">function</span><span class="w"> </span><span class="nx">getDaysInMonth</span><span class="p">(</span><span class="nx">month</span><span class="o">:</span><span class="w"> </span><span class="kt">Month</span><span class="p">,</span><span class="w"> </span><span class="nx">year</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">DaysInMonth</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isLeap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">isLeapYear</span><span class="p">(</span><span class="nx">year</span><span class="p">);</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">month</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Jan&quot;</span><span class="o">:</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Mar&quot;</span><span class="o">:</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;May&quot;</span><span class="o">:</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Jul&quot;</span><span class="o">:</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Oct&quot;</span><span class="o">:</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Dec&quot;</span><span class="o">:</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mf">31</span><span class="p">;</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Feb&quot;</span><span class="o">:</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">isLeap</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">29</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">28</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Apr&quot;</span><span class="o">:</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Jun&quot;</span><span class="o">:</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Aug&quot;</span><span class="o">:</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Sept&quot;</span><span class="o">:</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;Nov&quot;</span><span class="o">:</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mf">30</span><span class="p">;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="benefits-of-functions"><a class="toclink" href="../../2024/05/30/functional-foundations---functions/#benefits-of-functions">Benefits of Functions</a></h3>
<p>Now that we've covered what functions are and aren't, let's cover some of the reasons why we prefer functions for our logic.</p>
<p>First, mappings help us make sure that we've covered all our bases. We saw in the <code>getDaysInMonth</code> function we found a bug for when the month was February. Mappings can also be great conversation tools with non-engineers as they're intuitive to understand and to explain.</p>
<p>Second, functions are simple to test. Since the result is based solely on inputs, they are great candidates for unit testing and require little to no mocking to write them. I don't know about you, but I like simple test cases that help us build confidence that our application is working as intended.</p>
<p>Third, we can combine functions to make bigger functions using <em>composition</em>. At a high level, composition says that if we have two functions <code>f</code> and <code>g</code>, we can write a new function, <code>h</code> which takes the output of <code>f</code> and feeds it as the input for <code>g</code>.</p>
<p>Sounds theoretical, but let's take a look at a real example.</p>
<p>In the <a href="../../2020/05/20/learning-through-example--mars-rover-kata/">Mars Rover kata</a>, we end up building a basic console application that takes the input from the user (a string) and will need to convert it to the action that the rover takes.</p>
<p>In code, the logic looks like the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">rover</span><span class="o">:</span><span class="kt">Rover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="o">:</span><span class="s1">&#39;North&#39;</span><span class="p">};</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">convertStringToCommand</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">convertCommandToAction</span><span class="p">);</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nx">rover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">action</span><span class="p">(</span><span class="nx">rover</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>The annoying part is that we're iterating the list twice (once for each <code>map</code> call), and it'd be nice to get it down to a single iteration. This is where composition helps.</p>
<p>When we're running the <code>map</code>s back-to-back, we're accomplish the following workflow</p>
<p><img alt="Input to Command to Action Mapping" src="https://softwarementorblog.blob.core.windows.net/images/functional-functions/commandToActionMapping.png" width="1000px" /></p>
<p>Because each mapping is a function, we can compose the two into a new function, <code>stringToActionConverter</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">// using our f and g naming from earlier, convertString is f, convertCommand is g</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">stringToActionConverter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="kt">string</span><span class="p">)=&gt;</span><span class="nx">convertCommandToAction</span><span class="p">(</span><span class="nx">convertStringToCommand</span><span class="p">(</span><span class="nx">s</span><span class="p">));</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="kd">let</span><span class="w"> </span><span class="nx">rover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="o">:</span><span class="kt">0</span><span class="p">,</span><span class="w"> </span><span class="nx">direction</span><span class="o">:</span><span class="s1">&#39;North&#39;</span><span class="p">}</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">stringToActionConverter</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="nx">rover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">action</span><span class="p">(</span><span class="nx">rover</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="why-not-function-all-the-things"><a class="toclink" href="../../2024/05/30/functional-foundations---functions/#why-not-function-all-the-things">Why Not Function All the Things?</a></h3>
<p>Functions can greatly simplify our mental model as we don't have to keep track of state or other side effects. However, our applications typically deal with side affects (getting input from users, reading from files, interacting with databases) in order to do something useful. Because of this limitation, we strive to put all of our business rules into functions and keep the parts that interact with state as dumb as possible (that way we don't have to troubleshoot as much).</p>
<p>What I've found is that when working with applications, you end up with a <em>workflow</em> where you have input come in, gets processed, and then the result gets outputted.</p>
<p>Here's what an example workflow would look like</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1">// Logic to determine the &#39;FizzBuzziness&#39; of a number</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kd">function</span><span class="w"> </span><span class="nx">determineFizzBuzz</span><span class="p">(</span><span class="nx">input</span><span class="o">:</span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">15</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;FizzBuzz&#39;</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;Fizz&#39;</span><span class="p">;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;Buzz&#39;</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">input</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="p">}</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="kd">function</span><span class="w"> </span><span class="nx">workflow</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="c1">// Input Boundary</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;prompt-sync&#39;</span><span class="p">)();</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prompt</span><span class="p">();</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">  </span><span class="c1">// Business Rules</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">input</span><span class="si">}</span><span class="sb"> FizzBuzz value is </span><span class="si">${</span><span class="nx">determineFizzBuzz</span><span class="p">(</span><span class="o">+</span><span class="nx">input</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="sb">`Invalid input`</span><span class="p">;</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">  </span><span class="c1">// Output boundary</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="whats-next"><a class="toclink" href="../../2024/05/30/functional-foundations---functions/#whats-next">What's Next?</a></h3>
<p>Now that we have a rough understanding of functions, we can start exploring what happens when things go wrong. For example, could there have been a cleaner way of implementing the business rules of our workflow?</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-13 00:00:00+00:00">Apr 13, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">Functional Programming</a>, 
              <a href="../typescript/" class="md-meta__link">TypeScript</a>, 
              <a href="../today-i-learned/" class="md-meta__link">Today I Learned</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="today-i-learned-iterating-through-union-types"><a class="toclink" href="../../2024/04/13/today-i-learned---iterating-through-union-types/">Today I Learned - Iterating Through Union Types</a></h2>
<p>In a <a href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/">previous post</a>, we cover on how using union types in TypeScript is a great approach for domain modeling because it limits the possible values that a type can have.</p>
<p>For example, let's say that we're modeling a card game with a standard deck of playing cards. We could model the domain as such.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Ace&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Two&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Three&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Four&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Five&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Six&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Seven&quot;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Eight&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Nine&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Ten&quot;</span><span class="w"> </span><span class="o">|</span><span class="s2">&quot;Jack&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Queen&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;King&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Suite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hearts&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Clubs&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Spades&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;Diamonds&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Card</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">rank</span><span class="o">:</span><span class="kt">Rank</span><span class="p">;</span><span class="w"> </span><span class="nx">suite</span><span class="o">:</span><span class="kt">Suit</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With this modeling, there's no way to create a <code>Card</code> such that it has an invalid <code>Rank</code> or <code>Suite</code>.</p>
<p>With this definition, let's create a function to build the deck.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">createDeck</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">Card</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">ranks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Ace&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Three&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Four&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Five&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Seven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Eight&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Nine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Ten&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Queen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;King&quot;</span><span class="p">];</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">suites</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Hearts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Clubs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Spades&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Diamonds&quot;</span><span class="p">];</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">deck</span><span class="o">:</span><span class="kt">Card</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">rank</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">ranks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">suite</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">suites</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">      </span><span class="nx">deck</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">rank</span><span class="p">,</span><span class="w"> </span><span class="nx">suite</span><span class="p">});</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">deck</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This code works, however, I don't like the fact that I had to formally list the option for both <code>Rank</code> and <code>Suite</code> as this means that I have two different representtions for <code>Rank</code> and <code>Suite</code>, which implies tthat if we needed to add a new <code>Rank</code> or <code>Suite</code>, then we'd need to add it in two places (a violation of DRY).</p>
<p>Doing some digging, I found <a href="https://stackoverflow.com/questions/43067354/how-to-iterate-a-string-literal-type-in-typescript">this StackOverflow post</a> that gave a different way of defining our <code>Rank</code> and <code>Suite</code> types. Let's try that new definition.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">ranks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Ace&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Three&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Four&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Five&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Six&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Seven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Eight&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Nine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Ten&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Queen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;King&quot;</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">ranks</span><span class="p">[</span><span class="kt">number</span><span class="p">];</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">suites</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Hearts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Clubs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Spades&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Diamonds&quot;</span><span class="p">]</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kd">const</span><span class="p">;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Suite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">suites</span><span class="p">[</span><span class="kt">number</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>In this above code, we're saying that <code>ranks</code> cannot change (either by assignment or by operations like <code>push</code>). With that definition, we can say that <code>Rank</code> is some entry in the <code>ranks</code> array. Similar approach for our <code>suites</code> array and <code>Suite</code> type.</p>
<p>I prefer this approach much more because we have our ranks and suites defined in one place and our code reads cleaner as this says <em>Here are the possible ranks and Rank can only be one of those choices</em>.</p>
<h3 id="limitations"><a class="toclink" href="../../2024/04/13/today-i-learned---iterating-through-union-types/#limitations">Limitations</a></h3>
<p>The main limitation is that it only works for "enum" style unions. Let's change example and say that we want to model a series of shapes with the following.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Circle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">radius</span><span class="o">:</span><span class="kt">number</span><span class="p">};</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">length</span><span class="o">:</span><span class="kt">number</span><span class="p">};</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Rectangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nx">height</span><span class="o">:</span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="o">:</span><span class="kt">number</span><span class="p">}</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="kr">type</span><span class="w"> </span><span class="nx">Shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Circle</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Square</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">Rectangle</span>
</code></pre></div></td></tr></table></div>
<p>To use the same trick, we would need to have an array of constant values. However, we can't have a constant value for any of the <code>Shape</code>s because there are an infinite number of valid <code>Circle</code>s, <code>Square</code>s, and <code>Rectangle</code>s.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-04-09 00:00:00+00:00">Apr 9, 2024</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../typescript/" class="md-meta__link">TypeScript</a>, 
              <a href="./" class="md-meta__link">Functional Programming</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="exploring-map-with-property-based-thinking"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/">Exploring Map with Property Based Thinking</a></h2>
<p>When thinking about software, it's natural to think about the things that it can do (its features like generating reports or adding an item to a cart).</p>
<p>But what about the <em>properties</em> that those actions have? Those things that are always true?</p>
<p>In this post, let's take a look at a fundamental tool of functional programming, the <code>map</code> function.</p>
<p>All the code examples in this post will be using TypeScript, but the lessons hold for other languages with <code>Map</code> (or <code>Select</code> if you're coming from .NET).</p>
<h3 id="examining-map"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#examining-map">Examining Map</a></h3>
<p>In JavaScript/TypeScript, <code>map</code> is a function for arrays that allow us to transform an array of values into an array of different values.</p>
<p>For example, let's say that we have an array of names and we want to ensure that each name is capitalized, we can write the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">capitalize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">n</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">n</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="p">}</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span><span class="s2">&quot;charlotte&quot;</span><span class="p">];</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">properNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">capitalize</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>In our example, as long as we have a <a href="https://blog.thesoftwarementor.com/articles/2023/05/29/the-humble-function---foundation-to-functional-programming/#pure-functions">pure function</a> that takes a string and returns a new type, then <code>map</code> will work.</p>
<h3 id="what-does-map-guarantee"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#what-does-map-guarantee">What Does Map Guarantee?</a></h3>
<p>Map is a cool function because it has a lot of properties that we get for free.</p>
<ol>
<li>
<p>Maintains Length - If you call <code>map</code> on an array of 3 elements, then you'll get a new array with 3 elements. If you call <code>map</code> on an empty array, you'll get an empty array.</p>
</li>
<li>
<p>Maintains Type - If you call <code>map</code> on array of type <code>T</code> with a function that goes from <code>T</code> to <code>U</code>, then <em>every</em> element in the new array is of type <code>U</code>.</p>
</li>
<li>
<p>Maintains Order - If you call <code>map</code> on array with one function, then call <code>map</code> with a function that "undoes" the original map, then you end up with the original array.</p>
</li>
</ol>
<h3 id="writing-property-based-tests"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#writing-property-based-tests">Writing Property Based Tests</a></h3>
<p>To prove these properties, we can write a set of unit tests. However, it would be hard to write a single test that that covers a single property.</p>
<p>Most tests are <em>example based</em> in the sense that for a specific input, we get a specific output. <em>Property based</em> tests, on the other hand, uses random data and ensures that a property holds for all inputs. If it finds an input where the property fails, the test fails and you know which input caused the issue.</p>
<p>Most languages have a tool for writing property-based tests, so we'll be using <a href="https://fast-check.dev/">fast-check</a> for writing property based tests and <a href="https://jestjs.io/">jest</a> for our test runner</p>
<h4 id="checking-length-property"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#checking-length-property">Checking Length Property</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">fc</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;fast-check&quot;</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;maintains length&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="c1">// This is known as the identify function</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="c1">// as it returns whatever input it received</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">T</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="c1">// Fast Check assert that the following holds for all arrays of integers</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nx">fc</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">      </span><span class="c1">// data is the array of numbers</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">      </span><span class="nx">fc</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">integer</span><span class="p">()),</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">        </span><span class="c1">// We call the map function with the identify function</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">identity</span><span class="p">);</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">        </span><span class="c1">// We make sure that our result has the same length</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">      </span><span class="p">})</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">  </span><span class="p">});</span>
</code></pre></div></td></tr></table></div>
<p>If we run this test, we'll end up passing. But what is the value of <code>data</code>?</p>
<p>By adding a <code>console.log</code> in the test, we'll see the following values printed when we run the test (there are quite a few, so we'll examine the first few).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>console.log
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="o">[</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">       </span><span class="m">2125251991</span>,<span class="w">  </span><span class="m">1334674146</span>,
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">      </span>-1531633149,<span class="w">   </span><span class="m">332890473</span>,
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">       </span><span class="m">1313556939</span>,<span class="w">   </span><span class="m">907640912</span>,
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">        </span><span class="m">887735692</span>,<span class="w"> </span>-1979633703,
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">       </span>-259341001,<span class="w">  </span><span class="m">2015321027</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="o">]</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">  </span>console.log
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="o">[</span><span class="w"> </span><span class="m">1307879257</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span>console.log
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">    </span><span class="o">[]</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">  </span><span class="c1"># quite a few more...</span>
</code></pre></div></td></tr></table></div>
<h4 id="checking-type-property"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#checking-type-property">Checking Type Property</a></h4>
<p>We've proven that the length property is being followed, so let's look at how we can ensure that <code>result</code> has the right type.</p>
<p>To keep things simple, we're going to start with a <code>string[]</code> and map them to their lengths, yielding <code>number[]</code>.</p>
<p>If <code>map</code> is working, then the result should be all <code>number</code>s.</p>
<p>We can leverage <a href="https://www.typescriptlang.org/docs/handbook/2/typeof-types.html"><code>typeof</code></a> to check the type of each element in the array.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1">// An additional test in the describe block</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;maintains type&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">getLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="kt">string</span><span class="p">)=&gt;</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="nx">fc</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="c1">// asserting with an array of strings</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="nx">fc</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="kt">string</span><span class="p">()),</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">      </span><span class="c1">// mapping to lengths of strings</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">getLength</span><span class="p">);</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">      </span><span class="c1">// checking that all values are numbers</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">isAllValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">every</span><span class="p">((</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">);</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">isAllValid</span><span class="p">).</span><span class="nx">toBeTruthy</span><span class="p">();</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="p">});</span>
</code></pre></div></td></tr></table></div>
<p>Like before, we can add a <code>console.log</code> to the test to see what strings are being generated</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>console.log
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="s1">&#39;ptpJTR`G4&#39;</span>,<span class="w"> </span><span class="s1">&#39;s &gt;xmpXI&#39;</span>,<span class="w"> </span><span class="s1">&#39;H++%;a3Y&#39;</span>,<span class="w"> </span><span class="s1">&#39;OFD|+X8&#39;</span>,<span class="w"> </span><span class="s1">&#39;gp&#39;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>console.log
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="s1">&#39;Rq&#39;</span>,<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span><span class="s1">&#39;V&amp;+)Zy2VD8&#39;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>console.log
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="s1">&#39;o%}&#39;</span>,<span class="w"> </span><span class="s1">&#39;$o&#39;</span>,<span class="w"> </span><span class="s1">&#39;w7C&#39;</span>,<span class="w"> </span><span class="s1">&#39;O+!e&#39;</span>,<span class="w"> </span><span class="s1">&#39;NS$:4\\9aq&#39;</span>,<span class="w"> </span><span class="s1">&#39;xPbb}=F7h&#39;</span>,<span class="w"> </span><span class="s1">&#39;z&#39;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>console.log
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>console.log
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span><span class="s1">&#39;apply&#39;</span>,<span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">]</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>console.log
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">  </span><span class="o">[]</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="c1">## And many more entries...</span>
</code></pre></div></td></tr></table></div>
<h4 id="checking-order-property"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#checking-order-property">Checking Order Property</a></h4>
<p>For our third property, we need to ensure that the order of the array is being maintained.</p>
<p>To make this happen, we can use our <code>identity</code> function from before and check that our result is the same as the input. If so, then we know that the order is being maintained.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;maintains order&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="kt">T</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="nx">fc</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nx">fc</span><span class="p">.</span><span class="nx">property</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">fc</span><span class="p">.</span><span class="kt">string</span><span class="p">()),</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">identity</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">      </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="p">});</span>
</code></pre></div></td></tr></table></div>
<p>And with that, we've verified that our third property holds!</p>
<h3 id="so-what-why-properties"><a class="toclink" href="../../2024/04/09/exploring-map-with-property-based-thinking/#so-what-why-properties">So What, Why Properties?</a></h3>
<p>When I think about the code I write, I'm thinking about the way it works, the way it <em>should</em> work, and the ways it <em>shouldn't</em> work. I find example based tests to help understand a business flow because of it's concrete values while property based tests help me understand the general guarantees of the code.</p>
<p>I find that once I start thinking in properties, my code became cleaner because there's logic that I no longer had to write. In our <code>map</code> example, we don't have to write checks for if we have null or undefined because <code>map</code> <em>always</em> returns an array (empty in the worse case). There's also no need to write error handling because as long as the mapping function is pure, <code>map</code> will <em>always</em> return an array.</p>
<p>For those looking to learn more about functional programming, you'll find that properties help describe the higher level constructs (functors, monoids, and monads) and what to look for.</p>
<p>Finding properties can be a challenge, however, Scott Wlaschin (of FSharpForFunAndProfit) has a <a href="https://fsharpforfunandprofit.com/posts/property-based-testing-2/">great post talking about design patterns</a> that I've found to be immensely helpful.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-04-30 00:00:00+00:00">Apr 30, 2023</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">Functional Programming</a>, 
              <a href="../typescript/" class="md-meta__link">TypeScript</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="better-domain-modeling-with-discriminated-unions"><a class="toclink" href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/">Better Domain Modeling with Discriminated Unions</a></h2>
<p>When I think about software, I like designing software so that doing the right things are easy and doing the wrong things are impossible (or at least very hard). This approach is typically called <a href="https://blog.codinghorror.com/falling-into-the-pit-of-success/">falling into the pit of success</a>.</p>
<p>Having a well-defined domain model can prevent many mistakes from happening just because the code <em>literally</em> won't let it happen (either through a compilation error or other mechanisms).</p>
<p>I'm a proponent of functional programming as it allows us to model software in a better way that can reduce the number of errors we make.</p>
<p>Let's at one of my favorite techniques <em>discriminated unions</em>.</p>
<h3 id="motivation"><a class="toclink" href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/#motivation">Motivation</a></h3>
<p>In the GitHub API, there's an endpoint that allows you to get the <a href="https://docs.github.com/en/rest/issues/timeline?apiVersion=2022-11-28#list-timeline-events-for-an-issue">events that have occurred for a pull request</a>.</p>
<p>Let's take a look at the example response in the docs.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">[</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6430295168</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.github.com/repos/github/roadmap/issues/events/6430295168&quot;</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="nt">&quot;commit_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="nt">&quot;commit_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-04-13T20:49:13Z&quot;</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="nt">&quot;lock_reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6430296748</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.github.com/repos/github/roadmap/issues/events/6430296748&quot;</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;labeled&quot;</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="nt">&quot;commit_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="nt">&quot;commit_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-04-13T20:49:34Z&quot;</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;beta&quot;</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">      </span><span class="nt">&quot;color&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;99dd88&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6635165802</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.github.com/repos/github/roadmap/issues/events/6635165802&quot;</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;renamed&quot;</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">    </span><span class="nt">&quot;commit_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="nt">&quot;commit_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-05-18T19:29:01Z&quot;</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="nt">&quot;rename&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">      </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Secret scanning: dry-runs for enterprise-level custom patterns (cloud)&quot;</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">      </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Secret scanning: dry-runs for enterprise-level custom patterns&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>Based on the name of the docs, it seems like we'd expect to get back an array of events, let's call this <code>TimelineEvent[]</code>.</p>
<p>Let's go ahead and define the <code>TimelineEvent</code> type. One approach is to start copying the fields from the events in the array. By doing this, we would get the following.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">TimelineEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="nx">commit_id?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="nx">commit_url?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">  </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">  </span><span class="nx">lock_reason?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">  </span><span class="nx">label</span><span class="o">?:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">  </span><span class="nx">rename</span><span class="o">?:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="nx">from</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<h3 id="the-problem"><a class="toclink" href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/#the-problem">The Problem</a></h3>
<p>This definition will work, as it will cover all the data. However, the problem with this approach is that <code>lock_reason</code>, <code>label</code>, and <code>rename</code> had to be defined as nullable as they can sometimes be specified, but not always (for example, the <code>lock_reason</code> isn't specified for a label event).</p>
<p>Let's say that we wanted to write a function that printed data about <code>TimelineEvent</code>, we would have to write something like the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span>
<span class="normal"><a href="#__codelineno-2-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">printData</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">TimelineEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;labeled&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">label</span><span class="o">!</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// note the ! here, to tell TypeScript that I know it&#39;ll have a value</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">lock_reason</span><span class="p">);</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">rename</span><span class="o">!</span><span class="p">.</span><span class="kr">from</span><span class="p">);</span><span class="w"> </span><span class="c1">// note the ! here, to tell Typescript that I know it&#39;ll have a value</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The main problem is that the we have to remember that the <code>labeled</code> event has a <code>label</code> property, but not the <code>locked</code> property. It might not be a big deal right now, but given that the GitHub API has over <a href="https://docs.github.com/en/webhooks-and-events/events/issue-event-types">40 event types</a>, the odds of forgetting which properties belong where can be challenging.</p>
<p>The pattern here is that we have a type <code>TimelineEvent</code> that can have different, separate shapes, and we need a type that can represent all the shapes.</p>
<h3 id="the-solution"><a class="toclink" href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/#the-solution">The Solution</a></h3>
<p>One of the cool things about Typescript is that there is a <a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes-func.html#unions">union operator (|)</a>, that allows you to define a type as one of the other types.</p>
<p>Let's refactor our <code>TimelineEvent</code> model to use the union operator.</p>
<p>First, we need to define the different events as their own types</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">LockedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">  </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// note the hardcoded value for event</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">  </span><span class="nx">commit_id?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">  </span><span class="nx">commit_url?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">  </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">  </span><span class="nx">lock_reason?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="p">};</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="kr">type</span><span class="w"> </span><span class="nx">LabeledEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="w">  </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;labeled&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// note the hardcoded value for event</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">  </span><span class="nx">commit_id?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">  </span><span class="nx">commit_url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">  </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">  </span><span class="nx">label</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">    </span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="p">};</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="kr">type</span><span class="w"> </span><span class="nx">RenamedEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">  </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">  </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">  </span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;renamed&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// note the hardcoded value for event</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">  </span><span class="nx">commit_id?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">  </span><span class="nx">commit_url?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="w">  </span><span class="nx">created_at</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="w">  </span><span class="nx">rename</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">    </span><span class="nx">from</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="w">    </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>At this point, we have three types, one for each specific event. A <code>LockedEvent</code> has no knowledge of a <code>label</code> property and a <code>RenamedEvent</code> has no knowledge of a <code>lock_reason</code> property.</p>
<p>Next, we can update our definition of <code>TimelineEvent</code> to use the <em>union</em> operator as so.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kr">type</span><span class="w"> </span><span class="nx">TimelineEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">LockedEvent</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">LabeledEvent</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">RenamedEvent</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>This would be read as <em>A <code>TimelineEvent</code> can either be a <code>LockedEvent</code> or a <code>LabeledEvent</code> or a <code>RenamedEvent</code></em>.</p>
<p>With this new definition, let's rewrite the <code>printData</code> function.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span>
<span class="normal"><a href="#__codelineno-5-8">8</a></span>
<span class="normal"><a href="#__codelineno-5-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">printData</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span><span class="w"> </span><span class="kt">TimelineEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;labeled&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">label</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// note that we no longer need !</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;locked&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">lock_reason</span><span class="p">);</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">rename</span><span class="p">.</span><span class="nx">to</span><span class="p">);</span><span class="w"> </span><span class="c1">// note that we no longer need !</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Not only do we not have to use the <code>!</code> operator to ignore type safety, but we also have better autocomplete (note that <code>locked_reason</code> and <code>rename</code> don't appear when working with a labeled event).
<img alt="Better autocomplete" src="https://softwarementorblog.blob.core.windows.net/images/typescript-union-intellisense.png" /></p>
<h3 id="deeper-dive"><a class="toclink" href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/#deeper-dive">Deeper Dive</a></h3>
<p>At a general level, what we've modeled is a <a href="https://en.wikipedia.org/wiki/Tagged_union">sum type</a> and it's great for when you have a type that can take on a finite number of differing shapes.</p>
<p>Sum types are implemented as either <em>tagged unions</em> or <em>untagged unions</em>. Typescript has untagged unions, however, other languages like Haskell and F#, use tagged unions. Let's see what the same implementation in F# would have looked like.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1">// specific type definitions omitted since they&#39;re</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="c1">// similar to typescript definition</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="c1">// ....</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="k">type</span><span class="w"> </span><span class="nc">TimelineEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locked</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">LockedEvent</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Labeled</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">LabeledEvent</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Renamed</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">RenamedEvent</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">let</span><span class="w"> </span><span class="nv">printData</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Locked</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">printf</span><span class="w"> </span><span class="s">&quot;%s&quot;</span><span class="w"> </span><span class="n">l</span><span class="o">.</span><span class="n">lock_reason</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Labeled</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">printf</span><span class="w"> </span><span class="s">&quot;%s&quot;</span><span class="w"> </span><span class="n">l</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Renamed</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">printf</span><span class="w"> </span><span class="s">&quot;%s&quot;</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">rename</span><span class="o">.</span><span class="n">``to``</span><span class="w"> </span><span class="c1">// the `` is needed here as to is a reserved word in F#</span>
</code></pre></div></td></tr></table></div>
<p>A <em>tagged union</em> is when each shape has a specific constructor. So in the F# version, the <code>Locked</code> is the tag for the <code>LockedEvent</code>, <code>Labeled</code> is the tag for the <code>LabeledEvent</code>, so on and so forth. In the Typescript example, we worked around it because the <code>event</code> property is on every <code>TimelineEvent</code> and is a different value.</p>
<p>If that wasn't true, then we would had to have added a field to <code>TimelineEvent</code> (typically called <code>kind</code> or <code>tag</code>) that would help us differentiate between the various shapes.</p>
<h3 id="wrapping-up"><a class="toclink" href="../../2023/04/30/better-domain-modeling-with-discriminated-unions/#wrapping-up">Wrapping Up</a></h3>
<p>When defining domain models where the model can have different shapes, you can use a <em>sum</em> type to define the model.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2015-10-20 00:00:00+00:00">Oct 20, 2015</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">Functional Programming</a></li>
        
        
          
          <li class="md-meta__item">
            
              7 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="using-f-to-solve-a-constraints-problem"><a class="toclink" href="../../2015/10/20/using-f-to-solve-a-constraints-problem/">Using F# To Solve a Constraints Problem</a></h2>
<p>In this post, Im going to solve a logic puzzle using C# and F#. First, Ill define the problem being solved and what our restrictions are. Next, Ill show how Id break down the problem and write an easy-to-read, extendable solution using idiomatic C#. Afterwards, Ill solve the same problem and write an easy-to-read, extendable solution writing in idiomatic F#. Finally, well compare the two solutions and see why the F# solution is the better solution.</p>
<h3 id="the-problem"><a class="toclink" href="../../2015/10/20/using-f-to-solve-a-constraints-problem/#the-problem">The Problem</a></h3>
<p>For this problem, Im going to write a constraint solver (thanks to <a href="https://geoffmazeroff.com/">Geoff Mazeroff</a> for the inspiration).</p>
<p>If youre not familiar with the concept, a constraint is simply some rule that must be followed (such as all numbers must start with a 4). So a constraint solver is something that takes all the constraints and a source of inputs and returns all values that fit all the constraints.</p>
<p>With that being said, our source will be a list of positive integers and our constraints are the following:</p>
<ul>
<li>4 digits long (so 1000  9999)</li>
<li>Must be even (so 1000, 1002, 1004, etc)</li>
<li>The first digit must match the last digit (2002, 2012, 2022, etc)</li>
</ul>
<p>To further restrict solutions, all code will be production ready. This includes handling error conditions (like input being null), being maintainable (easily adding more constraints) and easy to read.</p>
<p>To quickly summarize, we need to find a robust, maintainable, and readable solution to help us find all 4 digit number that are even and that the first and last digit are equal.</p>
<h3 id="implementing-a-solution-in-c"><a class="toclink" href="../../2015/10/20/using-f-to-solve-a-constraints-problem/#implementing-a-solution-in-c">Implementing a Solution in C</a></h3>
<p>For the C# solution, Im going to need a class for every constraint, a class to execute all constraints against a source (positive integers) and a runner that ties all the pieces together.</p>
<p>Starting with the smaller blocks and building up, Im going to start with the constraint classes. Each constraint is going to take a single number and will return true if the number follows the constraint, false otherwise.</p>
<p>With that being said, Id first implement the constraint that all numbers must be 4 digits long</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span>
<span class="normal"><a href="#__codelineno-11-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MustBeFourDigitsLongConstraint</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">FollowsConstraint</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">value</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Second, Id write the constraint that all numbers must be even</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">MustBeEvenConstraint</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">FollowsConstraint</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Third, Id implement the constraint that all numbers must have the same first digit and the last digit</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">FirstDigitMustEqualLastDigitConstraint</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">FollowsConstraint</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">valueString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">valueString</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">valueString</span><span class="p">[</span><span class="n">valueString</span><span class="p">.</span><span class="n">Length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>At this point, I have the constraints written, but I need them to follow a general contract so that the <strong>Constraint Solver</strong> (about to be defined) can take a list of these constraints. Ill introduce an interface, <strong>IConstraint</strong> and update my classes to implement that interface.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span>
<span class="normal"><a href="#__codelineno-14-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IConstraint</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">FollowsConstraint</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="p">}</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">MustBeFourDigitsLongConstraint</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IConstraint</span><span class="w"> </span><span class="p">{</span><span class="cm">/* Implementation Details Omitted */</span><span class="p">}</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">MustBeEvenConstraint</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IConstraint</span><span class="w"> </span><span class="p">{</span><span class="cm">/* Implementation Details Omitted */</span><span class="p">}</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">FirstDigitMustEqualLastDigitConstraint</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IConstraint</span><span class="w"> </span><span class="p">{</span><span class="cm">/* Implementation Details Omitted */</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>So now I have the constraints defined and theyre now implementing a uniform interface, I can now create the constraint solver. This class is responsible for taking the list of numbers and the list of constraints and then returning a list of numbers that follow all constraints.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ConstraintSolver</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="nf">FindValues</span><span class="p">(</span><span class="n">List</span><span class="w"> </span><span class="n">constraints</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">constraints</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;constraints&quot;</span><span class="p">);</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;values&quot;</span><span class="p">);</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">constraint</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">constraints</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">constraint</span><span class="p">.</span><span class="n">FollowsConstraint</span><span class="p">(</span><span class="n">x</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, I can put all the pieces together using LINQPad (Full C# solution can be found here).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">IConstraint</span><span class="o">&gt;</span><span class="p">{</span><span class="k">new</span><span class="w"> </span><span class="n">MustBeFourDigitsLongConstraint</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MustBeEvenConstraint</span><span class="p">(),</span><span class="w"> </span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">             </span><span class="k">new</span><span class="w"> </span><span class="nf">FirstDigitMustEqualLastDigitConstraint</span><span class="p">()};</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">constraintSolver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConstraintSolver</span><span class="p">();</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constraintSolver</span><span class="p">.</span><span class="n">FindValues</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">ToList</span><span class="p">());</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This solution is easily extendable because if we need to add another constraint, we just add another class that implements the IConstraint interface and change the Main method to add an instance of the new constraint to the list of constraints.</p>
<h3 id="implementing-a-solution-in-f"><a class="toclink" href="../../2015/10/20/using-f-to-solve-a-constraints-problem/#implementing-a-solution-in-f">Implementing a Solution in F</a></h3>
<p>Now that we have the C# solution, lets take a look at how I would solve the problem using F#.</p>
<p>Similar to the C# solution, Im going to create a function for every constraint, a function to execute all constraints against a source (positive integers) and a runner that ties all the pieces together.</p>
<p>Also similar to the C# solution, Im going to start with creating the constraints and then work on the constraint solver function.</p>
<p>First, Id implement that the number must be four digits long constraint.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">mustBeFourDigit</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="n">number</span><span class="o">.</span><span class="n">ToString</span><span class="bp">()</span><span class="o">.</span><span class="n">Length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
</code></pre></div></td></tr></table></div>
<p>Next, the number must be even constraint.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">mustBeEven</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="n">number</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<p>Lastly, the first digit is the same as the last digit constraint.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">firstDigitMustBeEqualLast</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="nv">numberString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number</span><span class="o">.</span><span class="n">ToString</span><span class="bp">()</span><span class="o">.</span><span class="n">ToCharArray</span><span class="bp">()</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="nv">firstDigit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numberString</span><span class="o">.</span><span class="n">GetValue</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="k">let</span><span class="w"> </span><span class="nv">lastDigit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numberString</span><span class="o">.</span><span class="n">GetValue</span><span class="o">(</span><span class="n">numberString</span><span class="o">.</span><span class="n">Length</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">    </span><span class="n">firstDigit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastDigit</span>
</code></pre></div></td></tr></table></div>
<p>At this stage in the C# solution, I had to create an interface, <strong>IConstraint</strong>, so that the constraint solver could take a list of constraints. Whats cool with F# is that I dont have to define the interface. The F# type inference is saying that each of these functions are taking the same input (some generic `a) and returning a bool, so I can add all of them to the list. This is pretty convenient since I dont have to worry about this piece of plumbing.</p>
<p>Now that the different constraints are defined, Id go ahead and write the last function that takes a list of constraints and a list of numbers and returns the numbers that the constraints fit. (Confused by this function? Take a look at <a href="../../2015/10/13/implementing-your-own-version-of-fs-listfilter/">Implementing your own version of # List.Filter</a>)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span>
<span class="normal"><a href="#__codelineno-20-5">5</a></span>
<span class="normal"><a href="#__codelineno-20-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">rec</span><span class="w"> </span><span class="n">findValidNumbers</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="n">constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">constraints</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">numbers</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">firstConstraint</span><span class="o">::</span><span class="n">remainingConstraints</span><span class="w"> </span><span class="o">-&gt;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">        </span><span class="k">let</span><span class="w"> </span><span class="nv">validNumbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span><span class="w"> </span><span class="n">firstConstraint</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">        </span><span class="n">findValidNumbers</span><span class="w"> </span><span class="n">validNumbers</span><span class="w"> </span><span class="n">remainingConstraints</span>
</code></pre></div></td></tr></table></div>
<p>Finally, all the pieces are in place, so I can now put all the pieces together using LINQPad.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span>
<span class="normal"><a href="#__codelineno-21-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="mi">1000</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="mi">9999</span><span class="o">]</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="k">let</span><span class="w"> </span><span class="nv">constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">mustBeFourDigits</span><span class="o">;</span><span class="w"> </span><span class="n">mustBeEven</span><span class="o">;</span><span class="w"> </span><span class="n">firstDigitMustEqualLast</span><span class="o">;]</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">let</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findValidNumbers</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="n">constraints</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="n">printf</span><span class="w"> </span><span class="s">&quot;%A&quot;</span><span class="w"> </span><span class="n">result</span>
</code></pre></div></td></tr></table></div>
<h3 id="comparing-both-solutions"><a class="toclink" href="../../2015/10/20/using-f-to-solve-a-constraints-problem/#comparing-both-solutions">Comparing Both Solutions</a></h3>
<p>Now that we have both solutions written up, lets compare and see which solution is better.</p>
<p>First, the same design was used for both solutions. I decided to use this design for both because its flexible enough that we could add new constraints if needed (such as, the 2nd digit must be odd). As an example, for the C# solution, Id create a new class that implemented <strong>IConstraint</strong> and then update the runner to use the new class. For the F# solution, Id create a new function and update the runner. So, Id think its safe to say that both solutions score about the same from a maintainability and extendability point of view.</p>
<p>From an implementation perspective, both solutions are production ready since the code handles possible error conditions (C# with null checks in the <strong>ConstraintSolver</strong> class, F# with none because it doesnt support null). In addition to being robust, both solutions are readable by using ample whitespace and having all variables, classes, and interfaces clearly described.</p>
<p>With that being said, this is where the similarities end. When we look at how much code was written to solve the problem, we have a stark difference. For the C# solution, I ended up with 48 lines of code (omitting blank lines), however, for the F# solution, it only took 19. Now you could argue that I could have written the C# solution in fewer lines of code by removing curly braces around one line statements or ignoring null inputs. However, this would lead the code to be less robust.</p>
<p>Another difference between the F# solution and C# is that I was able to focus on the solution without having to wire up an interface. Youll often hear developers talk about the how little plumbing you need for F# to just work and this small example demonstrates that point.</p>
<p>Another difference (albeit subtle) is that the F# solution is that I can use the <strong>findValidNumbers</strong> function with any generic list of values and any generic list of functions that take the generic type and return true/false.</p>
<p>In other words, if I had another constraint problem using strings, Id still implement the different constraints, but I could use the same <strong>findValidNumbers</strong> function. At that point, however, Id probably rename it to <strong>findValidValues</strong> to signify the generic solution.</p>
<p>Whats awesome about this is that I didnt have to do any more work to have a generic solution, F# did that for me. To be fair, the C# solution can easily be made generic, but that would have to be a conscious design decision and I think thats a downside.</p>
<h3 id="tldr"><a class="toclink" href="../../2015/10/20/using-f-to-solve-a-constraints-problem/#tldr">TL;DR</a></h3>
<p>In this post, we took a look at solving a number constraint problem by using idiomatic C# and F#. Even though both solutions are easy to read and easy to extend, the F# version was less than 1/2 the size of the C# solution. In addition, I didnt have to do any plumbing for the F# version, but had to do some for the C# solution, and to top it off, the F# solution is generically solved, whereas the C# solution is not.</p>
    
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://github.com/cameronpresley.png" alt="Cameron Presley">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2015-10-13 00:00:00+00:00">Oct 13, 2015</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">Functional Programming</a>, 
              <a href="../net/" class="md-meta__link">.NET</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="implementing-your-own-version-of-fs-listfilter"><a class="toclink" href="../../2015/10/13/implementing-your-own-version-of-fs-listfilter/">Implementing Your Own Version of F#s List.Filter</a></h2>
<p>As Ive been thinking more about F#, I began to wonder how certain methods in the F# stack work, so I decided to implement F#s List.filter method.</p>
<p>For those of you who arent familiar, List.Filter takes a function that returns true or false and a list of values. The result of the call is all values that fulfill the fuction.</p>
<p>For example, if we wanted to keep just the even numbers in our list, then the following would accomplish that goal.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="mi">1</span><span class="o">;</span><span class="mi">2</span><span class="o">;</span><span class="mi">3</span><span class="o">;</span><span class="mi">4</span><span class="o">]</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="k">let</span><span class="w"> </span><span class="nv">isItEven</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="k">let</span><span class="w"> </span><span class="nv">evenValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span><span class="w"> </span><span class="n">isItEven</span><span class="w"> </span><span class="n">values</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1">// val it : int list = [2; 4]</span>
</code></pre></div></td></tr></table></div>
<p>Now that we know the problem, how would we begin to implement? First, we need to define a function called filter:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="bp">()</span><span class="w"> </span><span class="o">=</span>
</code></pre></div></td></tr></table></div>
<p>However, to match the signature for List.filter, it needs to take a function that maps integers to bools and the list of values to work on</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="o">(</span><span class="n">func</span><span class="o">:</span><span class="n">int</span><span class="o">-&gt;</span><span class="kt">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">values</span><span class="o">:</span><span class="n">int</span><span class="w"> </span><span class="n">List</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
</code></pre></div></td></tr></table></div>
<p>Now that we have the signature, lets add some logic to match on the list of values. When working with lists, there are two possibilities, an empty list and a non-empty list. Lets first explore the empty list option.</p>
<p>In the case of an empty list of values, then it doesnt matter what the func parameter does, there are no possible results, so we should return an empty list for the result.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="o">(</span><span class="n">func</span><span class="o">:</span><span class="n">int</span><span class="o">-&gt;</span><span class="kt">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">values</span><span class="o">:</span><span class="n">int</span><span class="w"> </span><span class="n">List</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span>
</code></pre></div></td></tr></table></div>
<p>Now that weve handled the empty list, lets explore the non-empty list scenario. In this branch, the list must have a head and a tail, so we can deconstruct the list to follow that pattern.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="o">(</span><span class="n">func</span><span class="o">:</span><span class="n">int</span><span class="o">-&gt;</span><span class="kt">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">values</span><span class="o">:</span><span class="n">int</span><span class="w"> </span><span class="n">List</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">head</span><span class="o">::</span><span class="n">tail</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1">// what goes here?</span>
</code></pre></div></td></tr></table></div>
<p>Now that weve deconstructed the list, we can now use the func parameter with the head element. If the value satisfies the func parameter, then we want to add the head element to the list of results and continue processing the rest of the list. To do that, we can use recursion to call back into filter with the same func parameter and the rest of the list:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span>
<span class="normal"><a href="#__codelineno-21-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">rec</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">(</span><span class="n">func</span><span class="o">:</span><span class="n">int</span><span class="o">-&gt;</span><span class="kt">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">values</span><span class="o">:</span><span class="n">int</span><span class="w"> </span><span class="n">List</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">head</span><span class="o">::</span><span class="n">tail</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">tail</span>
</code></pre></div></td></tr></table></div>
<p>At this point, we need to handle the case where the head element does not satisfy the func parameter. In this case, we should not add the element to the list of results and we should let filter continue the work</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span>
<span class="normal"><a href="#__codelineno-22-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">rec</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">(</span><span class="n">func</span><span class="o">:</span><span class="n">int</span><span class="o">-&gt;</span><span class="kt">bool</span><span class="o">)</span><span class="w"> </span><span class="o">(</span><span class="n">values</span><span class="o">:</span><span class="n">int</span><span class="w"> </span><span class="n">List</span><span class="o">)</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">head</span><span class="o">::</span><span class="n">tail</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">tail</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">         </span><span class="k">else</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">tail</span>
</code></pre></div></td></tr></table></div>
<p>By handling the base case first (an empty list), filter can focus on the current element in the list (head) and then recurse to process the rest of the list. This solution works, but we can make this better by removing the type annotations. Interestingly enough, we dont care if were working with integers, strings, or whatever. Just as long as the function takes some type and returns bool and the list of values matches the same type as the func parameter, it works. So then we end up with the following:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">let</span><span class="w"> </span><span class="nv">rec</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="k">with</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="bp">[]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="bp">[]</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">head</span><span class="o">::</span><span class="n">tail</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">tail</span>
</code></pre></div></td></tr></table></div>
<p>In general, when working with lists, I tend to start by matching the list with either an empty list or non-empty. From there, Ive got my base case, so I can focus on the implementation for the first element. After performing the work for the first element, I can then recurse to the next element.</p>
    
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../debugging/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Debugging">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Debugging
              </div>
            </div>
          </a>
        
        
          
          <a href="../interviewing/" class="md-footer__link md-footer__link--next" aria-label="Next: Interviewing">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Interviewing
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.ad38c271.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b66b2b78.min.js"></script>
      
    
  </body>
</html>